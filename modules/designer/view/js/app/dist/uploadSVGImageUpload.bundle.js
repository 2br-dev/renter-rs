(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{371:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s(30),a=s(51);class r extends i.a{loadSVGIcons(e){return this.makeGETRequest(window.global.designer.svgIconsURL).then(t=>{let s=t.list,i=[];return i.push(e),s&&s.length&&s.forEach(e=>{-1==i.indexOf(e.category)&&i.push(e.category)}),{icons:s,categories:i}})}loadPixabayImages(e,t,s,i){let r={term:e,category:t,p:s};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.pixabayImageSearchUrl,r)).then(e=>{let t=!1;if(e){let s=e.list;s&&s.length?s.forEach(e=>{i.push(e)}):t=!0}else a.a.showSimpleMessage(lang.t("Не удалось получить данные от сервера Pixabay")),t=!0;return{isEnd:t,visibleIcons:i}})}saveImageByURL(e){let t={url:e};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.saveImageByUrl,t))}deleteMediaFileByFileName(e){let t={file:e};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.deleteFileUrl,t))}deleteMediaImageByFileName(e){let t={file:e};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.deleteImageUrl,t))}loadMoreMediaFiles(e,t){let s={p:t};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.getUploadedFilesUrl,s)).then(t=>{let s=!1,i=t.list;return i&&i.length?i.forEach(t=>{e.push(t)}):s=!0,{isEnd:s,visibleIcons:e}})}loadMoreImageFiles(e,t){let s={p:t};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.getUploadedImagesUrl,s)).then(t=>{let s=!1,i=t.list;return i&&i.length?i.forEach(t=>{e.push(t)}):s=!0,{isEnd:s,visibleIcons:e}})}}},374:function(e,t,s){"use strict";const i=new(s(371).a);t.a={data:()=>({iconsLoaded:!1,inLoading:!1,isEnd:!1,curpage:0,visibleIcons:[]}),methods:{onScrollEnd(){if(this.inLoading||this.isEnd)return;let e=this.$refs.imageWrapper;e.offsetHeight+e.scrollTop>=e.scrollHeight-20&&this.loadMore()},onSearch(){this.term=this.$refs.searchInput.value,this.visibleIcons=[],this.curpage=0,this.inLoading=!1,this.isEnd=!1,this.loadMore()},onCategorySelect(e){this.current_category=e.target.value,this.visibleIcons=[],this.curpage=0,this.inLoading=!1,this.isEnd=!1,this.loadMore()},openUrl(e){window.open(e,"_blank")},saveImage(){this.$emit("save-image",this.files[0].url)},addHover(e){e.target.classList.toggle("hover")},saveImageByUrl(e,t){e.target.classList.contains("d-open")||(this.iconsLoaded=!1,i.saveImageByURL(t).then(e=>{this.$emit("save-image",e.url)}).catch(e=>{console.error(e.message),this.iconsLoaded=!0}))}}}},446:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"d-upload-list-wrapper d-svg-upload-list-wrapper"},[e.iconsLoaded?s("div",{staticClass:"d-category-wrapper"},[e._v("\n        "+e._s(e.lang("Категория"))+":\n        "),s("select",{staticClass:"d-upload-select",on:{change:e.onCategorySelect}},[e._l(e.categories,(function(t,i){return[s("option",{domProps:{selected:e.current_category==t,value:t}},[e._v(e._s(t))])]}))],2)]):e._e(),e._v(" "),e.iconsLoaded?s("div",{staticClass:"d-search-wrapper"},[s("input",{ref:"searchInput",staticClass:"d-search",attrs:{type:"search",placeholder:e.lang("Введите слово для поиска картинки")},on:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch(t)}}}),e._v(" "),s("button",{staticClass:"d-search-button",on:{click:e.onSearch}},[e._v(e._s(e.lang("Поиск")))])]):e._e(),e._v(" "),s("div",{ref:"imageWrapper",staticClass:"d-images-container",on:{"&scroll":function(t){return e.onScrollEnd(t)}}},[e.iconsLoaded?[s("div",{staticClass:"d-images-container-wrapper"},[e._l(e.visibleIcons,(function(t,i){return[s("a",{staticClass:"d-select-svg",on:{click:function(s){return s.preventDefault(),s.stopPropagation(),e.saveImageItem(t.src)}}},[s("div",{staticClass:"d-image-container",style:{backgroundImage:"url("+t.src+")"}}),e._v(" "),s("div",{staticClass:"d-image-title"},[e._v(e._s(t.title))])])]}))],2)]:e._e(),e._v(" "),e.iconsLoaded?e._e():s("div",{staticClass:"d-empty-message"},[s("span",[e._v(e._s(e.lang("Подождите...")))])])],2)])};i._withStripped=!0;var a=s(374),r=s(365),o=s(371),n=s(1),l=s(51);const c=new o.a;var d={data:()=>({curpage:-1,limit:45,offset:0,icons:[],term:"",categories:[],blocked:!1,first_category:lang.t("Все"),current_category:lang.t("Все")}),mounted(){c.loadSVGIcons(this.first_category).then(e=>{this.iconsLoaded=!0,this.icons=e.icons,this.categories=e.categories,this.loadMore()}),n.b.checkProSubscribe()||(this.blocked=!0)},methods:{onSearch(){this.term=this.$refs.searchInput.value,this.visibleIcons=[],this.offset=0,this.inLoading=!1,this.isEnd=!1,this.loadMore()},onCategorySelect(e){this.current_category=e.target.value,this.visibleIcons=[],this.offset=0,this.inLoading=!1,this.isEnd=!1,this.loadMore()},saveImage(e){this.$emit("save-image",e)},saveImageItem(e){n.b.checkProSubscribe()?this.saveImage(e):l.a.showError(lang.t('Отсутствует Pro подписка. <a href="https://readyscript.ru/drag-drop-constructor/" target="_blank">Как её получить?</a>'))},loadMore(){let e=this.limit;if(!this.icons[this.offset])return void(this.isEnd=!0);let t=this.offset;for(;e>=0;){if(!this.icons[t]){e=0;break}let s=this.icons[t];this.current_category==this.first_category||this.current_category==s.category?(this.term&&this.term.length?s.title.match(this.term.toLowerCase())&&(this.visibleIcons.push(s),e--):(this.visibleIcons.push(s),e--),t++):t++}this.offset=t}}},h={name:"SVGImageUpload",mixins:[r.a,a.a,d]},g=s(98),u=Object(g.a)(h,i,[],!1,null,null,null);u.options.__file="-readyscript/modules/designer/view/js/app/src/components/leftpanel/controls/upload/svgimageupload/svgimageupload.vue";t.default=u.exports}}]);