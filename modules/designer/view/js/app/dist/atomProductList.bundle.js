(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{366:function(t,e,s){"use strict";var o=s(7),i=s(156);s(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(s){console.info("name",t),console.info("attr",e),console.error(s)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(s=>{t[s]&&e.push("d-hidden-"+s)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}i.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,s=t.tag,o=this.getStyle,i=[],a=[];Object.keys(o).forEach(t=>{"padding-top"==t||"padding-bottom"==t?a.push(t+":"+o[t]):i.push(t+":"+o[t])});let r=this.getClass;return`<div style="${a.join(";")}"><${s} id="${this.getAtomTagId()}" class="${r} ${this.getAtomIdByBlockId()}" style="${i.join(";")}">${e}</${s}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let s=this.getData();s.css[t].value=e,this.setAtomData(s)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(o.b)(["closeLastPanel"]),...Object(o.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,s=t.tag;return`<${s} class="${this.getAtomIdByBlockId()}">${e}</${s}>`},contentWithoutClass(){let t=this.getData(),e=t.html,s=t.tag,o="";return this.getSpecialStyles&&(o="style='"+this.getSpecialStyles()+"'"),`<${s} ${o}>${e}</${s}>`},...Object(o.c)("blocks",["getAtomData"]),...Object(o.c)(["getMenuStack"])}}},367:function(t,e,s){"use strict";e.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(t){let e=t.split("/").pop().replace(".","_");if(!window[e+"_loaded"]){let s=document.createElement("script");s.type="text/javascript",s.src=t,document.body.appendChild(s),window[e+"_loaded"]=1}},loadExternalCSS(t){let e=t.split("/").pop().replace(".","_");window[e+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${t}" type="text/css" rel="stylesheet"/>\n               `))}}}},373:function(t,e,s){"use strict";e.a={data:()=>({currentSelectedCategory:"",categoriesLoaded:[],categoriesOpened:[],isCategoryListOpened:!1,categoryTree:[],isNeedShowSelectButton:!1}),methods:{onToggleCategorySelect(t){this.isCategoryListOpened=!this.isCategoryListOpened,this.isCategoryListOpened?this.addEditClass():(this.removeEditClass(),this.categoriesOpened=[])},isCategoryOpened(t){return-1!=this.categoriesOpened.indexOf(t)},insertCategoriesToTree(t={},e=[],s=0){if(s){let o=!1;t.forEach(t=>{t.id==s&&(t.childs=e,this.categoriesOpened.push(t.id),o=!0),!o&&t.childs&&this.insertCategoriesToTree(t.childs,e,s)})}else this.categoryTree=e},onCategorySelect(t){let e=t.target.closest(".d-tree-select_list-item");this.$refs.selectedCategory.dataset.id=e.dataset.id,this.currentSelectedCategory=e.dataset.title,this.isCategoryListOpened=!1,this.isNeedShowSelectButton=!0,this.removeEditClass(),t.preventDefault(),t.stopPropagation()},onCategoryClickEvents(t){t.target.classList.contains("d-tree-branch-toggle")?this.toggleCategory(t):this.onCategorySelect(t)},getCategoryItemsTree(t=null){let e=[];return null===t&&(t=this.categoryTree),Object.keys(t).forEach(s=>{let o=t[s],i="";o.childs&&(i=this.getCategoryItemsTree(o.childs));let a=o.childscount>0?"d-tree-branch":"d-tree-leaf";o.childscount>0&&this.isCategoryOpened(o.id)?a+=" d-tree-expanded":a+=" d-tree-collapsed",e.push(`\n                    <li class="d-tree-select_list-item ${a}" data-id="${o.id}" data-title="${o.title}">\n                        <div class="d-tree-select_list-item_row d-tree-row">\n                            <i class="d-tree-select_list-item_sublist-toggle zmdi d-tree-branch-toggle" data-id="${o.id}"></i>\n                            <span class="d-tree-select_list-item_title">${o.title}</span>\n                        </div>\n                        ${i.length?'<ul class="d-tree-select_list-item_sublist">':""}\n                            ${i}\n                        ${i.length?"</ul>":""}\n                    </li>\n                `)}),e.join("")},checkCloseCategoryMenu(t){if(t.target.closest(".d-atom-menu-category-select")){let e,s=t.target.closest(".d-atom");s?e=s.id.split("-").pop():(s=t.target.closest(".d-control-select-tree"),e=s.id.split("-").pop()),this.itemId!=e&&(this.isCategoryListOpened=!1)}else this.isCategoryListOpened=!1,this.removeEditClass()},getControlAtomId(){return"d-control-"+this.item.name+"-"+this.itemId},addEditClass(){this.addRowEditClass&&(this.addRowEditClass(),this.disableEditModeModules()),document.addEventListener(this.$clickevent,this.checkCloseCategoryMenu)},removeEditClass(){this.removeRowEditClass&&(this.removeRowEditClass(),this.enableEditModeModules()),document.removeEventListener(this.$clickevent,this.checkCloseCategoryMenu)}}}},392:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.getHiddenClasses()},[s("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),s("div",{ref:"thisAtom",staticClass:"d-atom",attrs:{id:t.getAtomIdByBlockId()},on:{click:function(e){return e.preventDefault(),t.openAtomProductParams(e)}}},[s("div",{staticClass:"d-atom-instance d-atom-productslist"},[t.inLoading?[s("div",{staticClass:"d-atom-form"},[s("div",{staticClass:"d-in-loading"},[t._v(t._s(t.lang("Подождите...")))])])]:[!1===t.getCategoryId?s("div",{staticClass:"d-atom-no-product"},[s("div",{staticClass:"d-atom-none-select"},[s("div",{staticClass:"d-atom-none-select-select-wrapper"},[s("div",{staticClass:"d-no-product-title"},[t._v(t._s(t.lang("Выберите категорию")))]),t._v(" "),s("div",{staticClass:"d-atom-menu-category-select"},[s("div",{staticClass:"d-tree-select",class:{open:t.isCategoryListOpened}},[s("div",{staticClass:"d-tree-select_selected-box",on:{click:function(e){return e.preventDefault(),t.onToggleCategorySelect(e)}}},[s("div",{ref:"selectedCategory",staticClass:"d-tree-select_selected-values",domProps:{textContent:t._s(t.currentSelectedCategory)}}),t._v(" "),t._m(0)]),t._v(" "),t.isCategoryListOpened?s("div",{staticClass:"d-tree-select_drop-box"},[s("ul",{staticClass:"d-tree-select_list",domProps:{innerHTML:t._s(t.getCategoryItemsTree())},on:{click:function(e){return e.preventDefault(),t.onCategoryClickEvents(e)}}})]):t._e()])])]),t._v(" "),t.isNeedShowSelectButton?s("a",{staticClass:"d-green-button",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.onMenuSelected(e)}}},[t._v(t._s(t.lang("Выбрать")))]):t._e(),t._v(" "),s("a",{staticClass:"d-gray-button",attrs:{href:t.addCategoryHref(),target:"_blank"},on:{click:function(t){t.stopPropagation()}}},[t._v(t._s(t.lang("Добавить категорию")))]),t._v(" "),s("a",{staticClass:"d-gray-button",attrs:{href:t.addProductHref(),target:"_blank"},on:{click:function(t){t.stopPropagation()}}},[t._v(t._s(t.lang("Добавить товар")))])])]):[t.products.length?s("div",{staticClass:"d-atom-item",class:t.getAtomClass()},[s("ul",{staticClass:"d-productslist-wrapper"},t._l(t.products,(function(e,o){return s("li",{key:o,staticClass:"d-productslist-item"},[s("div",{staticClass:"d-productslist-item-wrapper"},[s("a",{staticClass:"d-productslist-item-photo",style:{"background-image":"url("+e.image.url+")"}}),t._v(" "),s("div",{staticClass:"d-productslist-item-infoblock"},[s("a",[s("div",{staticClass:"d-productslist-item-title"},[t._v(t._s(e.title))]),t._v(" "),t.getAttrValue("show_barcode")?s("div",{staticClass:"d-productslist-item-barcode"},[t._v(t._s(e.barcode))]):t._e(),t._v(" "),s("div",{staticClass:"d-productslist-item-cost-wrapper"},[t.getAttrValue("show_price")?s("span",{staticClass:"d-productslist-item-cost"},[t._v(t._s(e.cost)+" "+t._s(e.currency))]):t._e(),t._v(" "),e.old_cost&&t.getAttrValue("show_old_price")?s("span",{staticClass:"d-productslist-item-old-cost"},[t._v(t._s(e.old_cost)+" "+t._s(e.currency))]):t._e()])]),t._v(" "),t.getAttrValue("show_buttons")?s("div",{staticClass:"d-productslist-button-wrapper"},[t.getAttrValue("show_buy_button")?[t.showBuyButton(e)?s("a",{staticClass:"d-productslist-buy-button",attrs:{title:t.lang("В корзину")},domProps:{innerHTML:t._s(t.getBuyButtonText())}}):t._e(),t._v(" "),t.showReservationButton(e)?s("a",{staticClass:"d-productslist-order-button",attrs:{title:t.lang("Заказать")},domProps:{innerHTML:t._s(t.getReservationButtonText())}}):t._e()]:t._e(),t._v(" "),t.showBuyOneClickButton(e)?s("a",{staticClass:"d-productslist-oneclick-button",attrs:{title:t.lang("Купить в 1 клик")},domProps:{innerHTML:t._s(t.getOneClickButtonText())}}):t._e()],2):t._e()])])])})),0),t._v(" "),t.getAttrValue("show_load_more")?s("div",{staticClass:"d-productlist-loadmore-wrapper"},[s("a",{staticClass:"d-productslist-loadmore"},[t._v(t._s(t.getAttrValue("load_more_text")))])]):t._e()]):t._e()]]],2)])],1)};o._withStripped=!0;var i=s(366),a=s(373),r=s(30);class d extends r.a{getCategoryList(t=0){let e=this.createUrlWithParams(window.global.designer.productslist.getCategoryListUrl,{root:t});return this.makeGETRequest(e)}getProductsList(t=0,e=1,s=20,o={}){let i=this.createUrlWithParams(window.global.designer.productslist.getProductsListUrl,{root:t,page:e,pageSize:s,photo:o});return this.makeGETRequest(i)}}const l=new d;var n={data:()=>({inLoading:!1,products:[],current_page:1}),mounted(){this.inLoading=!0,!1===this.getCategoryId?this.uploadCategoryToChoose():(this.uploadProducts(),this.uploadCategoryToChoose(!0)),this.setRedrawAtomListener(this.reMount),document.addEventListener("designer.productslist-update.photos",this.uploadProducts)},beforeDestroy(){this.removeRedrawAtomListener(this.reMount),document.removeEventListener("designer.productslist-update.photos",this.uploadProducts)},methods:{reMount(){this.inLoading=!0,this.products=[],this.current_page=0,this.uploadProducts()},openAtomProductParams(){this.body.removeEventListener("keyup",this.checkDeleteAtom),!1===this.getCategoryId?(this.setOpenHover(),this.body.addEventListener("keyup",this.checkDeleteAtom)):this.openAtomParams()},uploadCategoryToChoose(t=!1){l.getCategoryList().then(e=>{this.insertCategoriesToTree(this.categoryTree,e.list),t||(this.inLoading=!1),this.categoriesLoaded.push(0),this.isNeedShowSelectButton=!0}),this.currentSelectedCategory=lang.t("Не выбрано")},toggleCategory(t){let e=t.target,s=e.dataset.id,o=e.closest(".d-tree-branch");if(-1==this.categoriesLoaded.indexOf(s))o.classList.add("d-loading"),l.getCategoryList(s).then(t=>{this.insertCategoriesToTree(this.categoryTree,t.list,s),this.categoriesLoaded.push(s)});else if(o.classList.toggle("d-tree-expanded"),o.classList.toggle("d-tree-collapsed"),this.isCategoryOpened(s)){let t=this.categoriesOpened.indexOf(s);this.categoriesOpened.splice(t,1)}else this.categoriesOpened.push(s);t.preventDefault(),t.stopPropagation()},onMenuSelected(t){this.loading=!0;let e=this.getData();e.category_id=this.$refs.selectedCategory.dataset.id,this.setAtomData(e),this.uploadProducts(),t.preventDefault(),t.stopPropagation()},uploadProducts(t=1){let e=this.getData(),s={};s.type=e.attrs.photo_type.value,s.width=e.attrs.photo_width.value,s.height=e.attrs.photo_height.value,l.getProductsList(this.getCategoryId,t,this.getAttrValue("items_count"),s).then(t=>{this.products=t.list,this.inLoading=!1})},showBuyButton(t){return!!this.getAttrValue("show_always_button_buy")||t.buttons&&-1!=Object.keys(t.buttons).indexOf("buy")},showReservationButton(t){return!!this.getAttrValue("show_always_button_reservation")||t.buttons&&-1!=Object.keys(t.buttons).indexOf("reservation")},showBuyOneClickButton(t){return!!this.getAttrValue("show_always_button_oneclick")||!!this.getAttrValue("show_buy_oneclick")&&(t.buttons&&-1!=Object.keys(t.buttons).indexOf("oneclick"))},getBuyButtonText(){let t="";return this.getAttrValue("show_buy_icon")&&(t='<span class="d-atom-productslist-icon-buy"></span>'),`${t} ${this.getAttrValue("buy_button_text")}`},getReservationButtonText(){let t="";return this.getAttrValue("show_reservation_icon")&&(t='<span class="d-atom-productslist-icon-reservation"></span>'),`${t} ${this.getAttrValue("reservation_button_text")}`},getOneClickButtonText(){let t="";return this.getAttrValue("show_oneclick_icon")&&(t='<span class="d-atom-productslist-icon-oneclick"></span>'),`${t} ${this.getAttrValue("oneclick_button_text")}`},addCategoryHref:()=>window.global.designer.menu.categoryAddUrl,addProductHref:()=>window.global.designer.product.productAddUrl},computed:{getCategoryId(){let t=this.getData().category_id;return null!==t&&parseInt(t)}}},c=s(100),u=s(367),h=s(99),g={name:"ProductsListButton",mixins:[i.a,h.a,c.a,u.a,a.a,n],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>s.e(21).then(s.bind(null,421)),WidthResize:()=>s.e(74).then(s.bind(null,422))}},p=s(98),m=Object(p.a)(g,o,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"d-tree-select_drop-chevron-box"},[e("i",{staticClass:"d-tree-select_drop-chevron zmdi zmdi-caret-down"})])}],!1,null,null,null);m.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/productslist/productslist.vue";e.default=m.exports}}]);