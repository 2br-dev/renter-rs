(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{365:function(e,t,s){"use strict";var i=s(7),a=s(1);t.a={data:()=>({tinymceOptions:{height:200,theme:"modern",plugins:["link image lists anchor","searchreplace wordcount visualblocks visualchars code fullscreen media","save table contextmenu paste textcolor"],menubar:"file edit view",toolbar:"insertfile undo redo | styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons",language:"ru"},tinymceInlineOptions:{toolbar_items_size:"small",language:"ru",menubar:!1,inline:!0,plugins:"link textcolor",toolbar:"bold italic underline strikethrough",valid_elements:"*",valid_styles:{"*":"font-size,font-family,color,text-decoration,text-align"},extended_valid_elements:"*[*]",cleanup:!1,verify_html:!1,powerpaste_word_import:"clean",powerpaste_html_import:"clean",content_css:[]}}),methods:{getItemValue(e,t,s=null){let i=this.getItem();if(s){if(i.childs[s][e]&&i.childs[s][e][t])return i.childs[s][e][t].value;console.error(lang.t(`No property "${t}" in SUB CHILD item[${e}]`),i.childs[s][e])}else{if(i[e]&&i[e][t])return i[e][t].value;console.error(lang.t(`No property "${t}" in item[${e}]`),i[e])}return""},getItem(){switch(this.itemType){case a.a.atom:return this.getAtomData(this.blockId,this.itemId);case a.a.column:return this.getColumnData(this.blockId,this.itemId);case a.a.row:return this.getRowData(this.blockId,this.itemId);default:throw new Error(lang.t("Нет метода для получения данных. Тип: %0",[this.itemType]))}},getItemOptions(){return this.getItem()[this.keyName][this.item.name].data.options},setItemData(e){switch(this.itemType){case a.a.atom:this.setAtomData(e);break;case a.a.column:this.setColumnData(e);break;case a.a.row:this.setRowData(e);break;default:throw new Error(lang.t("Нет метода для получения данных. Тип: %0",[this.itemType]))}},setAtomKeyValue(e){let t=this.getItem();t[this.item.name]=e,this.setItemData(t);let s=new CustomEvent("designer.redraw-atom."+t.id,{detail:{id:t.id,value:e}});document.dispatchEvent(s),setTimeout(()=>{this.checkIfNeedSendEventAfterEdit(t)},500)},addStyleIfNeeded(e,t){"css"==this.keyName&&("background-image"==e&&t.trim().length&&(t="url('"+t+"')"),this.addStyleParameter(e,t))},checkIfNeedSendEventAfterEdit(e){if(e[this.keyName][this.item.name].debug_event){let t=new CustomEvent(e[this.keyName][this.item.name].debug_event,{detail:{id:this.itemId}});document.dispatchEvent(t)}},sendDataValueFromEvent(e){let t=e.target.value;"background-image"==this.item.name&&(t=t.replaceAll(" ","%20"));let s=this.getItem();"css"==this.keyName&&this.itemChildId?s.childs[this.itemChildId][this.keyName][this.item.name].value=t:(s[this.keyName][this.item.name].value=t,this.checkIfNeedSendEventAfterEdit(s)),this.setItemData(s)},sendDataValue(e){let t=this.getItem();"background-image"==this.item.name&&(e=e.replaceAll(" ","%20")),"css"==this.keyName&&this.itemChildId?t.childs[this.itemChildId][this.keyName][this.item.name].value=e:(t[this.keyName][this.item.name].value=e,this.checkIfNeedSendEventAfterEdit(t)),this.setItemData(t)},clear(){this.sendDataValue(""),this.isHoverable&&this.sendDataHoverValue("")},getStyleLikeObject(){let e=this.getItem();return a.b.convertInlineStyleToObject(e.attrs.style.value)},addStyleParameter(e,t){let s=this.getStyleLikeObject();"string"==typeof t?0==(t=t.trim()).length?delete s[e]:s[e]=t:"object"==typeof t&&(s[e]=t);let i=this.getItem();i.attrs.style.value=a.b.convertStyleObjectToString(s),this.setItemData(i)},...Object(i.b)("blocks",["setAtomData","setRowData","setColumnData"])},computed:{itemValue(){return this.getItemValue(this.keyName,this.item.name,this.itemChildId)},itemHoverValue(){return this.getItemHoverValue(this.keyName,this.item.name,this.itemChildId)},...Object(i.c)("blocks",["getAtomData","getColumnData","getRowData"])}}},373:function(e,t,s){"use strict";t.a={data:()=>({currentSelectedCategory:"",categoriesLoaded:[],categoriesOpened:[],isCategoryListOpened:!1,categoryTree:[],isNeedShowSelectButton:!1}),methods:{onToggleCategorySelect(e){this.isCategoryListOpened=!this.isCategoryListOpened,this.isCategoryListOpened?this.addEditClass():(this.removeEditClass(),this.categoriesOpened=[])},isCategoryOpened(e){return-1!=this.categoriesOpened.indexOf(e)},insertCategoriesToTree(e={},t=[],s=0){if(s){let i=!1;e.forEach(e=>{e.id==s&&(e.childs=t,this.categoriesOpened.push(e.id),i=!0),!i&&e.childs&&this.insertCategoriesToTree(e.childs,t,s)})}else this.categoryTree=t},onCategorySelect(e){let t=e.target.closest(".d-tree-select_list-item");this.$refs.selectedCategory.dataset.id=t.dataset.id,this.currentSelectedCategory=t.dataset.title,this.isCategoryListOpened=!1,this.isNeedShowSelectButton=!0,this.removeEditClass(),e.preventDefault(),e.stopPropagation()},onCategoryClickEvents(e){e.target.classList.contains("d-tree-branch-toggle")?this.toggleCategory(e):this.onCategorySelect(e)},getCategoryItemsTree(e=null){let t=[];return null===e&&(e=this.categoryTree),Object.keys(e).forEach(s=>{let i=e[s],a="";i.childs&&(a=this.getCategoryItemsTree(i.childs));let l=i.childscount>0?"d-tree-branch":"d-tree-leaf";i.childscount>0&&this.isCategoryOpened(i.id)?l+=" d-tree-expanded":l+=" d-tree-collapsed",t.push(`\n                    <li class="d-tree-select_list-item ${l}" data-id="${i.id}" data-title="${i.title}">\n                        <div class="d-tree-select_list-item_row d-tree-row">\n                            <i class="d-tree-select_list-item_sublist-toggle zmdi d-tree-branch-toggle" data-id="${i.id}"></i>\n                            <span class="d-tree-select_list-item_title">${i.title}</span>\n                        </div>\n                        ${a.length?'<ul class="d-tree-select_list-item_sublist">':""}\n                            ${a}\n                        ${a.length?"</ul>":""}\n                    </li>\n                `)}),t.join("")},checkCloseCategoryMenu(e){if(e.target.closest(".d-atom-menu-category-select")){let t,s=e.target.closest(".d-atom");s?t=s.id.split("-").pop():(s=e.target.closest(".d-control-select-tree"),t=s.id.split("-").pop()),this.itemId!=t&&(this.isCategoryListOpened=!1)}else this.isCategoryListOpened=!1,this.removeEditClass()},getControlAtomId(){return"d-control-"+this.item.name+"-"+this.itemId},addEditClass(){this.addRowEditClass&&(this.addRowEditClass(),this.disableEditModeModules()),document.addEventListener(this.$clickevent,this.checkCloseCategoryMenu)},removeEditClass(){this.removeRowEditClass&&(this.removeRowEditClass(),this.enableEditModeModules()),document.removeEventListener(this.$clickevent,this.checkCloseCategoryMenu)}}}},397:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"d-control-select-tree",attrs:{id:e.getControlAtomId()}},[e.inLoading?[s("div",{staticClass:"d-control-loading"},[e._v(e._s(e.lang("Подождите...")))])]:[s("div",{staticClass:"d-control-select-field-as-tree-wrapper"},[s("div",{staticClass:"d-atom-menu-category-select"},[s("div",{staticClass:"d-tree-select",class:{open:e.isCategoryListOpened}},[s("div",{staticClass:"d-tree-select_selected-box",on:{click:function(t){return t.preventDefault(),e.onToggleCategorySelect(t)}}},[s("div",{ref:"selectedCategory",staticClass:"d-tree-select_selected-values",attrs:{"data-id":e.fieldValue},domProps:{textContent:e._s(e.currentSelectedCategory)}}),e._v(" "),e._m(0)]),e._v(" "),e.isCategoryListOpened?s("div",{staticClass:"d-tree-select_drop-box"},[s("ul",{staticClass:"d-tree-select_list",domProps:{innerHTML:e._s(e.getCategoryItemsTree())},on:{click:function(t){return t.preventDefault(),e.onCategoryClickEvents(t)}}})]):e._e()])])]),e._v(" "),e.isNeedShowSelectButton?s("a",{staticClass:"d-green-button",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.sendSelectValue(t)}}},[e._v(e._s(e.lang("Выбрать")))]):e._e()]],2)};i._withStripped=!0;var a=s(365),l=s(373),r=s(30);class o extends r.a{getCategoryList(e,t,s=0){let i={};i[t]=s;let a=this.createUrlWithParams(e,i);return this.makeGETRequest(a)}}const n=new o;var d={data:()=>({inLoading:!0}),mounted(){this.uploadCategoryToChoose()},methods:{sendSelectValue(e){this.setAtomKeyValue(this.$refs.selectedCategory.dataset.id)},uploadCategoryToChoose(e=!1){let t=this.itemValue.toString(),s=this.item.data.param_name;n.getCategoryList(t,s).then(t=>{this.insertCategoriesToTree(this.categoryTree,t.list),e||(this.inLoading=!1),this.$refs.selectedCategory=this.categoriesLoaded.push(0),this.isNeedShowSelectButton=!0}),this.currentSelectedCategory=lang.t("Не выбрано")},toggleCategory(e){let t=e.target,s=t.dataset.id,i=t.closest(".d-tree-branch"),a=this.itemValue.toString(),l=this.item.data.param_name;if(-1==this.categoriesLoaded.indexOf(s))i.classList.add("d-loading"),n.getCategoryList(a,l,s).then(e=>{this.insertCategoriesToTree(this.categoryTree,e.list,s),this.categoriesLoaded.push(s)});else if(i.classList.toggle("d-tree-expanded"),i.classList.toggle("d-tree-collapsed"),this.isCategoryOpened(a,l,s)){let e=this.categoriesOpened.indexOf(s);this.categoriesOpened.splice(e,1)}else this.categoriesOpened.push(s);e.preventDefault(),e.stopPropagation()}},computed:{fieldValue(){return this.getItem()[this.item.name]}}},c={name:"ControlSelectFieldValueAsTree",mixins:[a.a,l.a,d],props:{keyName:{type:String,required:!0},blockId:{type:[String,Number],required:!0},itemType:{type:String,required:!0},itemId:{type:String,required:!0},item:{type:Object,required:!0},itemChildId:{type:[String,Number]}}},h=s(98),m=Object(h.a)(c,i,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"d-tree-select_drop-chevron-box"},[t("i",{staticClass:"d-tree-select_drop-chevron zmdi zmdi-caret-down"})])}],!1,null,null,null);m.options.__file="-readyscript/modules/designer/view/js/app/src/components/leftpanel/controls/selectfieldvalueastree/selectfieldvalueastree.vue";t.default=m.exports}}]);