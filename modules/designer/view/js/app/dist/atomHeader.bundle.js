(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{366:function(t,e,i){"use strict";var s=i(7),a=i(156);i(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(i){console.info("name",t),console.info("attr",e),console.error(i)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(i=>{t[i]&&e.push("d-hidden-"+i)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}a.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,i=t.tag,s=this.getStyle,a=[],o=[];Object.keys(s).forEach(t=>{"padding-top"==t||"padding-bottom"==t?o.push(t+":"+s[t]):a.push(t+":"+s[t])});let l=this.getClass;return`<div style="${o.join(";")}"><${i} id="${this.getAtomTagId()}" class="${l} ${this.getAtomIdByBlockId()}" style="${a.join(";")}">${e}</${i}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let i=this.getData();i.css[t].value=e,this.setAtomData(i)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(s.b)(["closeLastPanel"]),...Object(s.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,i=t.tag;return`<${i} class="${this.getAtomIdByBlockId()}">${e}</${i}>`},contentWithoutClass(){let t=this.getData(),e=t.html,i=t.tag,s="";return this.getSpecialStyles&&(s="style='"+this.getSpecialStyles()+"'"),`<${i} ${s}>${e}</${i}>`},...Object(s.c)("blocks",["getAtomData"]),...Object(s.c)(["getMenuStack"])}}},367:function(t,e,i){"use strict";e.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(t){let e=t.split("/").pop().replace(".","_");if(!window[e+"_loaded"]){let i=document.createElement("script");i.type="text/javascript",i.src=t,document.body.appendChild(i),window[e+"_loaded"]=1}},loadExternalCSS(t){let e=t.split("/").pop().replace(".","_");window[e+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${t}" type="text/css" rel="stylesheet"/>\n               `))}}}},409:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.getHiddenClasses()},[i("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),i("div",{ref:"thisAtom",staticClass:"d-atom d-atom-header",attrs:{id:t.getAtomIdByBlockId()},on:{dblclick:function(e){return e.preventDefault(),e.stopPropagation(),t.openInlineEditor()},click:function(e){return e.preventDefault(),e.stopPropagation(),t.openAtomParams(e)}}},[i("div",{staticClass:"d-atom-text"},[t.modeTiny?i("div",{staticClass:"d-atom-instance"},[i("tinymce-editor",{ref:"editorLink",class:t.getTinyClasses(),attrs:{inline:"",id:t.getAtomTagId(),"initial-value":t.getInitialValue,"tag-name":t.tagName,init:t.tinyMCEOptions},on:{onInit:t.onInitTinyMCE,onBlur:t.onBlurTinyMCE}})],1):i("div",{staticClass:"d-atom-text-wrapper"},[i("div",{class:["d-atom-text-center",t.getAtomClass()],style:t.getTextWidthParams()},[i("WidthResize",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),i("div",{staticClass:"d-atom-instance",domProps:{innerHTML:t._s(t.contentWithoutClass)}})],1)])])])],1)};s._withStripped=!0;var a=i(366),o=(i(7),i(1)),l={data(){return{modeTiny:!1,tinyMCEOptions:{menubar:!1,language:"ru",plugins:["link","lists","autolink"],toolbar:["bold italic underline fontselect designerFontSize link unlink forecolor backcolor designerAlignLeft designerAlignCenter designerAlignRight designerAlignJustify selectTags"],setup:t=>{t.ui.registry.addSplitButton("designerFontSize",o.b.getTinyMceFontSizePlagin(t)),t.ui.registry.addToggleButton("designerAlignLeft",{icon:"align-left",tooltip:"Align Left",onAction:e=>{this.setCSSParamValue("text-align","left"),t.focus()}}),t.ui.registry.addToggleButton("designerAlignCenter",{icon:"align-center",tooltip:"Align Center",onAction:e=>{this.setCSSParamValue("text-align","center"),t.focus()}}),t.ui.registry.addToggleButton("designerAlignRight",{icon:"align-right",tooltip:"Align Right",onAction:e=>{this.setCSSParamValue("text-align","right"),t.focus()}}),t.ui.registry.addToggleButton("designerAlignJustify",{icon:"align-justify",tooltip:"Align Justify",onAction:t=>{let e=this.getData();e.css["text-align"].value="justify",this.setAtomData(e)}});let e=this.getData();t.ui.registry.addMenuButton("selectTags",{text:e.tag.toString().toLocaleUpperCase(),fetch:t=>{let e=this.getData().tags,i=[];e.forEach(t=>{i.push({type:"menuitem",text:t.toString().toLocaleUpperCase(),onAction:async()=>{let e=this.getData();e.tag=t,this.setAtomData(e),this.modeTiny=!1,this.body.classList.remove("d-edit-mode"),setTimeout(()=>{this.openInlineEditor()},200)}})}),t(i)}})}},load_js:[window.global.designer.tinymce_js_url]}},computed:{tagName(){return this.getData().tag},getInitialValue(){return this.getData().html},tinyPaddingStyles(){let t=this.getStyle,e={};return Object.keys(t).forEach(i=>{"padding-top"!=i&&"padding-bottom"!=i||(e[i]=t[i])}),e}},methods:{onInitTinyMCE(t){let e=t.target;tinymce.get(this.getAtomTagId()).focus(),e.selection.getSel().selectAllChildren(e.getBody())},async onBlurTinyMCE(t){let e=t.target,i=document.getElementById(this.getAtomTagId());i.style.textAlign&&await this.setCSSParamValue("text-align",i.style.textAlign),this.removeFlagDoubleClick();let s=this.getData();s.html=e.getContent(),this.setAtomData(s),this.modeTiny=!1},getTinyClasses(){return this.getClass+" "+this.getAtomIdByBlockId()},openInlineEditor(){o.b.closeAllPanels(),this.setFlagDoubleClick(),this.modeTiny=!0,this.body.classList.add("d-edit-mode")},getSpecialStyles(){return this.atom=this.getData(),"text-align: "+this.atom.css["text-align"].value},getTextWidthParams(){let t=this.getData().css["max-width"].value;return t.length||(t="100%"),{"max-width":t}}}},n=i(100),d=i(367),r=i(99),c={name:"AtomHeader",mixins:[a.a,r.a,l,d.a,n.a],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>i.e(21).then(i.bind(null,421)),WidthResize:()=>i.e(74).then(i.bind(null,422)),"tinymce-editor":()=>i.e(68).then(i.bind(null,385))}},g=i(98),m=Object(g.a)(c,s,[],!1,null,null,null);m.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/header/header.vue";e.default=m.exports}}]);