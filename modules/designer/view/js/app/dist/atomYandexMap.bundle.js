(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{366:function(t,e,a){"use strict";var s=a(7),o=a(156);a(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(a){console.info("name",t),console.info("attr",e),console.error(a)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(a=>{t[a]&&e.push("d-hidden-"+a)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}o.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,a=t.tag,s=this.getStyle,o=[],i=[];Object.keys(s).forEach(t=>{"padding-top"==t||"padding-bottom"==t?i.push(t+":"+s[t]):o.push(t+":"+s[t])});let n=this.getClass;return`<div style="${i.join(";")}"><${a} id="${this.getAtomTagId()}" class="${n} ${this.getAtomIdByBlockId()}" style="${o.join(";")}">${e}</${a}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let a=this.getData();a.css[t].value=e,this.setAtomData(a)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(s.b)(["closeLastPanel"]),...Object(s.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,a=t.tag;return`<${a} class="${this.getAtomIdByBlockId()}">${e}</${a}>`},contentWithoutClass(){let t=this.getData(),e=t.html,a=t.tag,s="";return this.getSpecialStyles&&(s="style='"+this.getSpecialStyles()+"'"),`<${a} ${s}>${e}</${a}>`},...Object(s.c)("blocks",["getAtomData"]),...Object(s.c)(["getMenuStack"])}}},367:function(t,e,a){"use strict";e.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(t){let e=t.split("/").pop().replace(".","_");if(!window[e+"_loaded"]){let a=document.createElement("script");a.type="text/javascript",a.src=t,document.body.appendChild(a),window[e+"_loaded"]=1}},loadExternalCSS(t){let e=t.split("/").pop().replace(".","_");window[e+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${t}" type="text/css" rel="stylesheet"/>\n               `))}}}},412:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.getHiddenClasses()},[a("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),a("div",{ref:"thisAtom",staticClass:"d-atom d-atom-yandex-map-wrapper",attrs:{id:t.getAtomIdByBlockId()},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.openAtomParams(e)}}},[a("div",{staticClass:"d-atom-instance d-atom-yandexmap",class:t.getAtomClass()},[a("WidthResize",{attrs:{"block-id":t.blockId,"item-id":t.itemId},on:{resizeBlock:function(e){return t.resizeMap()}}}),t._v(" "),a("div",{staticClass:"d-atom-yandex-map",style:t.getWidthHeightStyle(),attrs:{id:t.getMapId()}})],1)])],1)};s._withStripped=!0;var o=a(366),i=a(367),n={data:()=>({load_js:["https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey="+window.global.designer.yandexmap.api_key],mapInstance:{},geoObject:{},geoPoint:{},resizeTimeout:null}),mounted(){this.initMap(),document.addEventListener("designer.yandexmap-reload",this.reInitMap),document.addEventListener("designer.change-column-width",this.resizeMap),document.addEventListener("designer.change-row-width",this.resizeMap)},beforeDestroy(){document.removeEventListener("designer.yandexmap-reload",this.reInitMap),document.removeEventListener("designer.change-column-width",this.resizeMap),document.removeEventListener("designer.change-row-width",this.resizeMap)},methods:{resizeMap(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{clearTimeout(this.resizeTimeout),this.mapInstance.container.fitToViewport()},100)},initMapEvents(){let t=this.getData();this.mapInstance.events.add("boundschange",e=>{let a=e.get("newZoom"),s=e.get("newCenter");a!==e.get("oldZoom")&&(t.attrs.zoom.value=a),t.attrs.map_lat.value=s[0],t.attrs.map_long.value=s[1],this.setAtomData(t)}),this.mapInstance.events.add("typechange",e=>{t.attrs.type.value=e.get(this.getMapId())._type,this.setAtomData(t)})},initMapControls(){let t=this.mapInstance.controls,e=this.getData().attrs;return e.show_search.value?t.add("searchControl"):t.remove("searchControl"),e.show_type_selector.value?t.add("typeSelector"):t.remove("typeSelector"),e.show_fullscreen.value?t.add("fullscreenControl"):t.remove("fullscreenControl"),e.show_route_button.value?t.add("routeButtonControl"):t.remove("routeButtonControl"),e.show_zoom.value?t.add("zoomControl"):t.remove("zoomControl"),this.getAttrValue("enable_scroll_zoom")?this.mapInstance.behaviors.enable("scrollZoom"):this.mapInstance.behaviors.disable("scrollZoom"),t},initMapObjectManager(){let t=new ymaps.ObjectManager({clusterize:!0,gridSize:32,clusterDisableClickZoom:!1});t.objects.options.set("preset","islands#blueDotIcon"),t.clusters.options.set("preset","islands#blueClusterIcons"),this.mapInstance.geoObjects.add(t)},initMap(){let t=setInterval(()=>{if(window.ymaps){clearInterval(t);let e=()=>{let t=this.getData();this.mapInstance=new ymaps.Map(this.getMapId(),{center:[+t.attrs.map_lat.value,+t.attrs.map_long.value],zoom:+t.attrs.zoom.value}),this.initMapObjectManager(),this.initMapEvents(),this.initMapControls(),this.setMapPoints()};ymaps.ready(e)}},100)},getWidthHeightStyle(){let t=this.getData();return{width:t.css["max-width"].value,height:t.css.height.value}},setMapPoints(){let t=this.getData().attrs.points.value,e={type:"FeatureCollection",features:[]};t.forEach((t,a)=>{let s={type:"Feature",id:a,geometry:{type:"Point",coordinates:[t.lat,t.long]},properties:{balloonContentBody:t.baloon,hintContent:t.title}};e.features.push(s)});let a=this.mapInstance.geoObjects.get(0);a.removeAll(),a.add(e)},getMapId(){return"d-map"+this.itemId},reInitMap(t){if(t&&t.detail.id!=this.itemId)return;let e=setTimeout(()=>{clearTimeout(e),this.initMapControls(),this.setMapPoints();let t=this.getData().attrs;t.map_lat.value&&t.map_long.value&&this.mapInstance.setCenter([t.map_lat.value,t.map_long.value]),t.zoom.value&&this.mapInstance.setZoom([t.zoom.value]),this.mapInstance.container.fitToViewport()},200)}}},l=a(100),r=a(99),d={name:"AtomYandexMap",mixins:[o.a,r.a,l.a,i.a,n],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>a.e(21).then(a.bind(null,421)),WidthResize:()=>a.e(74).then(a.bind(null,422))}},c=a(98),m=Object(c.a)(d,s,[],!1,null,null,null);m.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/yandexmap/yandexmap.vue";e.default=m.exports}}]);