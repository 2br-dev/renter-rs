(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{366:function(t,e,a){"use strict";var s=a(7),l=a(156);a(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(a){console.info("name",t),console.info("attr",e),console.error(a)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(a=>{t[a]&&e.push("d-hidden-"+a)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}l.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,a=t.tag,s=this.getStyle,l=[],i=[];Object.keys(s).forEach(t=>{"padding-top"==t||"padding-bottom"==t?i.push(t+":"+s[t]):l.push(t+":"+s[t])});let o=this.getClass;return`<div style="${i.join(";")}"><${a} id="${this.getAtomTagId()}" class="${o} ${this.getAtomIdByBlockId()}" style="${l.join(";")}">${e}</${a}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let a=this.getData();a.css[t].value=e,this.setAtomData(a)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(s.b)(["closeLastPanel"]),...Object(s.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,a=t.tag;return`<${a} class="${this.getAtomIdByBlockId()}">${e}</${a}>`},contentWithoutClass(){let t=this.getData(),e=t.html,a=t.tag,s="";return this.getSpecialStyles&&(s="style='"+this.getSpecialStyles()+"'"),`<${a} ${s}>${e}</${a}>`},...Object(s.c)("blocks",["getAtomData"]),...Object(s.c)(["getMenuStack"])}}},367:function(t,e,a){"use strict";e.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(t){let e=t.split("/").pop().replace(".","_");if(!window[e+"_loaded"]){let a=document.createElement("script");a.type="text/javascript",a.src=t,document.body.appendChild(a),window[e+"_loaded"]=1}},loadExternalCSS(t){let e=t.split("/").pop().replace(".","_");window[e+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${t}" type="text/css" rel="stylesheet"/>\n               `))}}}},393:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.getHiddenClasses()},[a("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),a("div",{ref:"thisAtom",staticClass:"d-atom d-atom-gallery",attrs:{id:t.getAtomIdByBlockId()},on:{click:function(e){return e.preventDefault(),t.openAtomFormParams(e)}}},[t.inLoading?[a("div",{staticClass:"d-atom-form"},[a("div",{staticClass:"d-in-loading"},[t._v(t._s(t.lang("Подождите...")))])])]:[t.getGalleryId?a("div",{staticClass:"d-atom-wrapper-container",class:t.getAtomClass()},[a("div",{staticClass:"d-atom-instance d-atom-gallery-container"},[a("WidthResize",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),t.getAttrValue("show_title")?a("div",{staticClass:"d-gallery-photo-title"},[t._v("\n                        "+t._s(t.album.title)+"\n                    ")]):t._e(),t._v(" "),a("div",{staticClass:"d-gallery-wrapper",attrs:{id:t.getGalleyWrapperId()}},[a("div",{staticClass:"d-gallery-settings"}),t._v(" "),t._l(t.album.images,(function(e,s){return[a("div",{staticClass:"d-gallery-photo-item"},[a("a",{staticClass:"d-gallery-photo-wrapper",attrs:{href:e.big}},[a("div",{staticClass:"d-gallery-photo",style:{"background-image":"url("+e.medium+")"}},[a("img",{attrs:{src:e.medium,alt:""}})]),t._v(" "),t.getAttrValue("show_description")?a("div",{staticClass:"d-gallery-photo-description"},[t._v("\n                                        "+t._s(e.title)+"\n                                    ")]):t._e()])])]}))],2)],1)]):a("div",{staticClass:"d-atom-none-select-instance"},[a("div",{staticClass:"d-atom-none-select"},[a("div",{staticClass:"d-atom-none-select-select-wrapper"},[a("p",[t._v(t._s(t.lang("Выберите альбом:")))]),t._v(" "),a("select",{ref:"selectGallery",staticClass:"d-atom-none-select-form-select",on:{change:function(e){return e.preventDefault(),e.stopPropagation(),t.onAlbumSelect(e)}}},[t._l(t.galleriesList(),(function(e,s){return[a("option",{domProps:{value:s}},[t._v(t._s(e))])]}))],2)]),t._v(" "),t.isNeedShowSelectButton?a("a",{staticClass:"d-green-button",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.onSelectGallery(e)}}},[t._v(t._s(t.lang("Выбрать")))]):t._e(),t._v(" "),a("a",{staticClass:"d-gray-button",attrs:{href:t.addFormHref(),target:"_blank"},on:{click:function(t){t.stopPropagation()}}},[t._v(t._s(t.lang("Добавить")))])])])]],2)],1)};s._withStripped=!0;var l=a(366),i=a(30);class o extends i.a{getGalleryList(){return this.makeGETRequest(window.global.designer.gallery.albumsList)}getGalleryData(t,e){let a={album_id:t,photo:e},s=this.createUrlWithParams(window.global.designer.gallery.getAlbumByIdUrl,a);return this.makeGETRequest(s)}}a(7);const r=new o;var d={data:()=>({inLoading:!0,isNeedShowSelectButton:!1,album:{},load_js:[window.global.designer.lightgallery_js_url],load_css:[window.global.designer.lightgallery_css_url]}),mounted(){this.onMount(),this.setRedrawAtomListener(this.onMount),document.addEventListener("designer.gallery-reinit.gallery",this.uploadGalleryInfo)},beforeUpdate(){setTimeout(()=>{this.$refs.selectGallery&&this.$refs.selectGallery.dispatchEvent(new Event("change"))},300)},beforeDestroy(){this.body.removeEventListener("keyup",this.checkDeleteAtom),document.addEventListener("designer.gallery-reinit.gallery",this.uploadGalleryInfo),this.removeRedrawAtomListener(this.onMount)},methods:{onMount(){this.inLoading=!0,this.getGalleryId?(this.inLoading=!0,this.uploadGalleryInfo(this.getGalleryId)):this.inLoading=!1},getGalleyWrapperId(){return"d-atom-photo-wrapper-"+this.itemId},onSelectGallery(t){let e=this.getData();e.gallery_id=this.$refs.selectGallery.value,this.uploadGalleryInfo(e.gallery_id),this.setAtomData(e)},addFormHref:()=>window.global.designer.gallery.albumAddUrl,galleriesList:()=>window.global.designer.gallery.albumsList,openAtomFormParams(){this.body.removeEventListener("keyup",this.checkDeleteAtom),this.getGalleryId?this.openAtomParams():(this.setOpenHover(),this.body.addEventListener("keyup",this.checkDeleteAtom))},onAlbumSelect(t){this.isNeedShowSelectButton=t.target.value>0},uploadGalleryInfo(t){let e=this.getData();e.gallery_id=t,this.setAtomData(e),this.inLoading=!0;let a={};a.width=parseInt(this.getAttrValue("photo_width"),10),a.height=parseInt(this.getAttrValue("photo_height"),10),a.big_width=parseInt(this.getAttrValue("photo_big_width"),10),a.big_height=parseInt(this.getAttrValue("photo_big_height"),10),a.type=this.getAttrValue("photo_type"),setTimeout(()=>{r.getGalleryData(e.gallery_id,a).then(this.galleryUploaded)},200)},galleryUploaded(t){this.album=t.album,this.body.removeEventListener("keyup",this.checkDeleteAtom),this.inLoading=!1;let e=setInterval(()=>{"undefined"!=typeof lightGallery&&(clearInterval(e),lightGallery(document.querySelector("#"+this.getGalleyWrapperId()),{thumbnail:!0,selector:"a"}))},200)}},computed:{getGalleryId(){return parseInt(this.getData().gallery_id)}}},n=a(100),c=a(367),h=a(99),g={name:"AtomGallery",mixins:[l.a,h.a,c.a,n.a,d],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>a.e(21).then(a.bind(null,421)),WidthResize:()=>a.e(74).then(a.bind(null,422))}},m=a(98),u=Object(m.a)(g,s,[],!1,null,null,null);u.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/gallery/gallery.vue";e.default=u.exports}}]);