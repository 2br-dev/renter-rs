(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{366:function(t,e,s){"use strict";var o=s(7),a=s(156);s(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(s){console.info("name",t),console.info("attr",e),console.error(s)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(s=>{t[s]&&e.push("d-hidden-"+s)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}a.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,s=t.tag,o=this.getStyle,a=[],i=[];Object.keys(o).forEach(t=>{"padding-top"==t||"padding-bottom"==t?i.push(t+":"+o[t]):a.push(t+":"+o[t])});let r=this.getClass;return`<div style="${i.join(";")}"><${s} id="${this.getAtomTagId()}" class="${r} ${this.getAtomIdByBlockId()}" style="${a.join(";")}">${e}</${s}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let s=this.getData();s.css[t].value=e,this.setAtomData(s)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(o.b)(["closeLastPanel"]),...Object(o.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,s=t.tag;return`<${s} class="${this.getAtomIdByBlockId()}">${e}</${s}>`},contentWithoutClass(){let t=this.getData(),e=t.html,s=t.tag,o="";return this.getSpecialStyles&&(o="style='"+this.getSpecialStyles()+"'"),`<${s} ${o}>${e}</${s}>`},...Object(o.c)("blocks",["getAtomData"]),...Object(o.c)(["getMenuStack"])}}},394:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.getHiddenClasses()},[s("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),s("div",{ref:"thisAtom",staticClass:"d-atom",attrs:{id:t.getAtomIdByBlockId()},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.openAtomVideoParams(e)}}},[s("div",{staticClass:"d-atom-instance no-hover d-atom-video"},[t.getSrc?[s("div",{staticClass:"d-atom-item",class:t.getAtomIdByBlockId()},[s("div",{staticClass:"d-atom-video-inner",class:t.getRatioClass()},[s("WidthResize",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),t.showVideo?t._e():s("div",{staticClass:"d-atom-video-play-wrapper",class:t.getRatioClass(),style:t.getBackgroundImage()},[s("a",{staticClass:"d-atom-video-play"})]),t._v(" "),"youtube"!=t.getAttrValue("type")?s("video",{attrs:{poster:t.getImage()}},[s("source",{attrs:{src:t.getSrc,type:"video/mp4"}}),t._v("\n                            "+t._s(t.lang("Ваш браузер не поддерживает тег video. Браузер устарел"))+"\n                        ")]):t._e()],1)])]:s("div",{staticClass:"d-atom-none-select-instance"},[s("div",{staticClass:"d-atom-video-wrapper"},[s("div",{staticClass:"d-atom-video-title"},[t._v("Видео")]),t._v(" "),s("select",{staticClass:"d-atom-video-type",on:{change:function(e){return e.preventDefault(),e.stopPropagation(),t.changeType(e)}}},[s("option",{attrs:{value:"youtube"},domProps:{selected:"youtube"==t.getAttrValue("type")}},[t._v("Youtube")]),t._v(" "),s("option",{attrs:{value:"mp4"},domProps:{selected:"mp4"==t.getAttrValue("type")}},[t._v("Ссылка")])]),t._v(" "),t.error?s("div",{staticClass:"d-atom-video-error"},[t._v(t._s(t.error))]):t._e(),t._v(" "),s("input",{ref:"videoText",staticClass:"d-atom-video-text",attrs:{type:"text",placeholder:t.getPlaceholder()},on:{focus:t.disableAtomMove,mousemove:function(e){return e.stopPropagation(),t.disableAtomMove(e)},mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:t.disableAtomMove(e)},input:function(e){return e.preventDefault(),e.stopPropagation(),t.linkPaste(e)}}})])])],2)])],1)};o._withStripped=!0;var a=s(366),i=s(30);class r extends i.a{getVideoExists(t,e){let s={type:t,url:e};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.video.videoExists,s))}}const l=new r;var d={data:()=>({placeholders:{youtube:lang.t("Укажите ссылку на страницу Youtube"),mp4:lang.t("Укажите ссылку на видео .mp4")},ratios:{"21:9":"ratio21by9","16:9":"ratio16by9","4:3":"ratio4by3","1:1":"ratio1by1"},showVideo:!1,inputTimeout:null,error:null}),methods:{openAtomVideoParams(){this.body.removeEventListener("keyup",this.checkDeleteAtom),this.getSrc?this.openAtomParams():(this.setOpenHover(),this.body.addEventListener("keyup",this.checkDeleteAtom))},changeType(t){let e=this.getData();if(e.attrs.type.value=t.target.value,this.setAtomData(e),this.$refs.videoText.value.length){let t={};t.target=this.$refs.videoText,this.linkPaste(t)}},getPlaceholder(){return this.placeholders[this.getAttrValue("type")]},disableAtomMove(){this.setColumnDraggable(!1),this.body.addEventListener(this.$mouseup,()=>{this.setColumnDraggable(!0)})},linkPaste(t){this.error=null,clearTimeout(this.inputTimeout),this.inputTimeout=setTimeout(()=>{clearTimeout(this.inputTimeout);let e=t.target.value,s=this.getAttrValue("type");e.length?l.getVideoExists(s,e).then(t=>{if(this.setColumnDraggable(!0),t.success){let o=e,a=this.getData();"youtube"==s&&(o=t.video,a.attrs.ratio.value=t.ratio,a.css["background-image"].value=t.image),o=o.split("://"),a.attrs.src.value.protocol=o[0]+"://",a.attrs.src.value.href=o[1],this.setAtomData(a)}else this.error=t.messages[0].text}):this.error=lang.t("Укажите адрес видео")},200)},getRatioClass(){let t=this.getAttrValue("ratio");return this.ratios[t]},getImage(){return this.getCSSValue("background-image")},getBackgroundImage(){return{"background-image":"url('"+this.getImage()+"')"}}},computed:{getSrc(){let t=this.getData().attrs.src.value,e=!1;return t.href.length&&(e=`${t.protocol}${t.href}`),e}}},n=s(100),c=s(99),u={name:"AtomVideo",mixins:[a.a,c.a,n.a,d],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>s.e(21).then(s.bind(null,421)),WidthResize:()=>s.e(74).then(s.bind(null,422))}},m=s(98),g=Object(m.a)(u,o,[],!1,null,null,null);g.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/video/video.vue";e.default=g.exports}}]);