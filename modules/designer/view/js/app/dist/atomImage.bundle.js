(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{365:function(e,t,i){"use strict";var s=i(7),a=i(1);t.a={data:()=>({tinymceOptions:{height:200,theme:"modern",plugins:["link image lists anchor","searchreplace wordcount visualblocks visualchars code fullscreen media","save table contextmenu paste textcolor"],menubar:"file edit view",toolbar:"insertfile undo redo | styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons",language:"ru"},tinymceInlineOptions:{toolbar_items_size:"small",language:"ru",menubar:!1,inline:!0,plugins:"link textcolor",toolbar:"bold italic underline strikethrough",valid_elements:"*",valid_styles:{"*":"font-size,font-family,color,text-decoration,text-align"},extended_valid_elements:"*[*]",cleanup:!1,verify_html:!1,powerpaste_word_import:"clean",powerpaste_html_import:"clean",content_css:[]}}),methods:{getItemValue(e,t,i=null){let s=this.getItem();if(i){if(s.childs[i][e]&&s.childs[i][e][t])return s.childs[i][e][t].value;console.error(lang.t(`No property "${t}" in SUB CHILD item[${e}]`),s.childs[i][e])}else{if(s[e]&&s[e][t])return s[e][t].value;console.error(lang.t(`No property "${t}" in item[${e}]`),s[e])}return""},getItem(){switch(this.itemType){case a.a.atom:return this.getAtomData(this.blockId,this.itemId);case a.a.column:return this.getColumnData(this.blockId,this.itemId);case a.a.row:return this.getRowData(this.blockId,this.itemId);default:throw new Error(lang.t("Нет метода для получения данных. Тип: %0",[this.itemType]))}},getItemOptions(){return this.getItem()[this.keyName][this.item.name].data.options},setItemData(e){switch(this.itemType){case a.a.atom:this.setAtomData(e);break;case a.a.column:this.setColumnData(e);break;case a.a.row:this.setRowData(e);break;default:throw new Error(lang.t("Нет метода для получения данных. Тип: %0",[this.itemType]))}},setAtomKeyValue(e){let t=this.getItem();t[this.item.name]=e,this.setItemData(t);let i=new CustomEvent("designer.redraw-atom."+t.id,{detail:{id:t.id,value:e}});document.dispatchEvent(i),setTimeout(()=>{this.checkIfNeedSendEventAfterEdit(t)},500)},addStyleIfNeeded(e,t){"css"==this.keyName&&("background-image"==e&&t.trim().length&&(t="url('"+t+"')"),this.addStyleParameter(e,t))},checkIfNeedSendEventAfterEdit(e){if(e[this.keyName][this.item.name].debug_event){let t=new CustomEvent(e[this.keyName][this.item.name].debug_event,{detail:{id:this.itemId}});document.dispatchEvent(t)}},sendDataValueFromEvent(e){let t=e.target.value;"background-image"==this.item.name&&(t=t.replaceAll(" ","%20"));let i=this.getItem();"css"==this.keyName&&this.itemChildId?i.childs[this.itemChildId][this.keyName][this.item.name].value=t:(i[this.keyName][this.item.name].value=t,this.checkIfNeedSendEventAfterEdit(i)),this.setItemData(i)},sendDataValue(e){let t=this.getItem();"background-image"==this.item.name&&(e=e.replaceAll(" ","%20")),"css"==this.keyName&&this.itemChildId?t.childs[this.itemChildId][this.keyName][this.item.name].value=e:(t[this.keyName][this.item.name].value=e,this.checkIfNeedSendEventAfterEdit(t)),this.setItemData(t)},clear(){this.sendDataValue(""),this.isHoverable&&this.sendDataHoverValue("")},getStyleLikeObject(){let e=this.getItem();return a.b.convertInlineStyleToObject(e.attrs.style.value)},addStyleParameter(e,t){let i=this.getStyleLikeObject();"string"==typeof t?0==(t=t.trim()).length?delete i[e]:i[e]=t:"object"==typeof t&&(i[e]=t);let s=this.getItem();s.attrs.style.value=a.b.convertStyleObjectToString(i),this.setItemData(s)},...Object(s.b)("blocks",["setAtomData","setRowData","setColumnData"])},computed:{itemValue(){return this.getItemValue(this.keyName,this.item.name,this.itemChildId)},itemHoverValue(){return this.getItemHoverValue(this.keyName,this.item.name,this.itemChildId)},...Object(s.c)("blocks",["getAtomData","getColumnData","getRowData"])}}},366:function(e,t,i){"use strict";var s=i(7),a=i(156);i(1);t.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(e){let t=this.getAttrs()[e];try{return t||console.error(lang.t(`Не найден аттрибут "${e}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),t.value}catch(i){console.info("name",e),console.info("attr",t),console.error(i)}},getCSSValue(e){return this.getData().css[e].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let e=this.getAdditionalClass();return this.getAtomIdByBlockId()+(e?" "+e:"")},getHiddenClasses(){let e=this.getData().hidden,t=[];return Object.keys(e).forEach(i=>{e[i]&&t.push("d-hidden-"+i)}),t},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let e=setTimeout(()=>{if(clearTimeout(e),sessionStorage.getItem("atom-dbl-click"))return;let t=this.getMenuStack;if(t.length){let e=t[t.length-1];if("atom"==e.data.type&&e.data.blockId==this.blockId&&e.data.id==this.itemId)return}a.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(e=>{e.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let e=this.getData(),t=e.html,i=e.tag,s=this.getStyle,a=[],o=[];Object.keys(s).forEach(e=>{"padding-top"==e||"padding-bottom"==e?o.push(e+":"+s[e]):a.push(e+":"+s[e])});let n=this.getClass;return`<div style="${o.join(";")}"><${i} id="${this.getAtomTagId()}" class="${n} ${this.getAtomIdByBlockId()}" style="${a.join(";")}">${t}</${i}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(e,t){let i=this.getData();i.css[e].value=t,this.setAtomData(i)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let e=this.body.querySelectorAll(".module-wrapper");e&&e.forEach(e=>{e.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let e=document.querySelector("body").querySelectorAll(".module-wrapper");e&&e.forEach(e=>{e.classList.remove("disabled")})},setColumnDraggable(e){let t=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:e}});document.dispatchEvent(t)},setRedrawAtomListener(e){document.addEventListener("designer.redraw-atom."+this.itemId,e)},removeRedrawAtomListener(e){document.removeEventListener("designer.redraw-atom."+this.itemId,e)},...Object(s.b)(["closeLastPanel"]),...Object(s.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let e=this.getData(),t=e.html,i=e.tag;return`<${i} class="${this.getAtomIdByBlockId()}">${t}</${i}>`},contentWithoutClass(){let e=this.getData(),t=e.html,i=e.tag,s="";return this.getSpecialStyles&&(s="style='"+this.getSpecialStyles()+"'"),`<${i} ${s}>${t}</${i}>`},...Object(s.c)("blocks",["getAtomData"]),...Object(s.c)(["getMenuStack"])}}},367:function(e,t,i){"use strict";t.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(e){let t=e.split("/").pop().replace(".","_");if(!window[t+"_loaded"]){let i=document.createElement("script");i.type="text/javascript",i.src=e,document.body.appendChild(i),window[t+"_loaded"]=1}},loadExternalCSS(e){let t=e.split("/").pop().replace(".","_");window[t+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${e}" type="text/css" rel="stylesheet"/>\n               `))}}}},377:function(e,t,i){"use strict";var s=i(1);t.a={data:()=>({currentTab:"load",tabs:[{title:lang.t("Файл"),alias:"load",blocked:!1},{title:lang.t("Иконки"),alias:"icons",blocked:!1},{title:lang.t("Pixabay"),alias:"pixabay",blocked:!1},{title:lang.t("Загрузки"),alias:"loaded",blocked:!1}]}),mounted(){s.b.checkProSubscribe()||(this.tabs[1].blocked=!0,this.tabs[2].blocked=!0)},methods:{selectTab(e){this.currentTab=e},isActiveTab(e){return this.currentTab==e},close(){this.$modal.hide("upload")}}}},386:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"d-dialog-wrapper"},[i("h4",{staticClass:"d-dialog-title"},[e._v(e._s(e.lang("Загрузка фото")))]),e._v(" "),i("span",{staticClass:"close",on:{click:function(t){return t.preventDefault(),e.close(t)}}}),e._v(" "),i("ul",{staticClass:"d-dialog-tabs-list"},[e._l(e.tabs,(function(t,s){return[i("li",{staticClass:"d-dialog-tabitem",class:{"d-active":e.isActiveTab(t.alias)}},[i("a",{on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.selectTab(t.alias)}}},[e._v("\n                    "+e._s(t.title)+" "),t.blocked?i("span",{staticClass:"d-tab-locked",attrs:{title:e.lang("Отсутствует Pro подписка")}}):e._e()])])]}))],2),e._v(" "),i("div",{staticClass:"d-dialog-tabsections"},["load"==e.currentTab?i("div",{staticClass:"d-dialog-tabsection"},[i("SimpleImageUpload",{on:{"save-image":e.saveImage}})],1):"icons"==e.currentTab?i("div",{staticClass:"d-dialog-tabsection"},[i("SVGImageUpload",{on:{"save-image":e.saveImage}})],1):"pixabay"==e.currentTab?i("div",{staticClass:"d-dialog-tabsection"},[i("PixabayUpload",{on:{"save-image":e.saveImage}})],1):"loaded"==e.currentTab?i("div",{staticClass:"d-dialog-tabsection"},[i("ImageFiles",{on:{"save-image":e.saveImage}})],1):e._e()])])};s._withStripped=!0;var a=i(365),o=i(377),n={data:()=>({load_js:[window.global.designer.lightgallery_js_url],load_css:[window.global.designer.lightgallery_css_url]}),methods:{saveImage(e){let t=new CustomEvent("atom-image-image-uploaded",{detail:{id:this.elementId,url:e}});document.getElementById(this.elementId).dispatchEvent(t),this.close()}}},d=i(367),l={name:"ImageUploadDirect",mixins:[a.a,o.a,d.a,n],props:{elementId:{type:[String,Number],required:!0},item:{type:Object,required:!0}},components:{SimpleImageUpload:()=>Promise.all([i.e(1),i.e(72)]).then(i.bind(null,445)),SVGImageUpload:()=>i.e(71).then(i.bind(null,446)),PixabayUpload:()=>i.e(70).then(i.bind(null,447)),ImageFiles:()=>i.e(69).then(i.bind(null,399))}},r=i(98),h=Object(r.a)(l,s,[],!1,null,null,null);h.options.__file="-readyscript/modules/designer/view/js/app/src/components/leftpanel/controls/upload/imageuploaddirect/imageuploaddirect.vue";t.default=h.exports},387:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"d-atom-flex-wrapper d-atom-image-all-wrapper",class:e.getHiddenClasses()},["none"==e.editMode?i("AtomMarginZone",{attrs:{"block-id":e.blockId,"item-id":e.itemId}}):e._e(),e._v(" "),i("div",{ref:"thisAtom",class:"d-atom "+e.getAtomClass(),attrs:{id:e.getAtomIdByBlockId()},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.clickChooseModeToEnable(t)}}},[e.need_crop?i("div",{staticClass:"d-atom-image-wrapper"},[i("div",{staticClass:"d-overflow"},[i("div",{staticClass:"d-atom-image-crop-wrapper",style:{width:e.boundaryWidth+"px"},on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:"button"in t&&0!==t.button?null:e.addCropEditMode(t)},"&touchstart":function(t){return e.addCropEditMode(t)}}},[e.boundaryHeight?i("vue-croppie",{ref:"croppieRef",attrs:{enableOrientation:!0,enableExif:!0,viewport:{height:e.viewportHeight,width:e.viewportWidth,type:"square"},boundary:{height:e.boundaryHeight}}}):e._e(),e._v(" "),i("a",{staticClass:"d-image-close-copping",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.crop(t)}}})],1)])]):i("div",{ref:"mainImageWrapper",staticClass:"d-atom-instance d-atom-instance-image-wrapper no-hover"},[i("div",{staticClass:"d-atom-image-wrapper",class:{"d-with-padding":e.isWithPaddingClass,"d-image-svg":e.isSVGImage}},[e.isInEditWidthMode()&&e.showResizerHandler("right")?i("div",{staticClass:"d-atom-image-width-padding d-left"},[e.isWithPaddingClass?i("span",{staticClass:"d-blow-pixels-wrapper d-left"},[i("span",{staticClass:"d-blow-pixels",class:{"d-show":"0px"!=e.leftPixels}},[e._v(e._s(e.leftPixels))])]):e._e(),e._v(" "),i("a",{staticClass:"d-round-width-handler d-left",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),i=t,e.startDragWidth(i,"left"));var i},"&touchstart":function(t){return t.stopPropagation(),i=t,e.startDragWidth(i,"left");var i}}})]):e._e(),e._v(" "),e.isInEditWidthMode()&&e.showResizerHandler("left")?i("div",{staticClass:"d-atom-image-width-padding d-right"},[e.isWithPaddingClass?i("span",{staticClass:"d-blow-pixels-wrapper d-right"},[i("span",{staticClass:"d-blow-pixels",class:{"d-show":"0px"!=e.leftPixels}},[e._v(e._s(e.leftPixels))])]):e._e(),e._v(" "),i("a",{staticClass:"d-round-width-handler d-right",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),i=t,e.startDragWidth(i,"right"));var i},"&touchstart":function(t){return t.stopPropagation(),i=t,e.startDragWidth(i,"right");var i}}})]):e._e(),e._v(" "),i("div",{staticClass:"d-overflow",style:{height:e.getHeight()}},[i("div",{ref:"mainImageInnerWrapper",staticClass:"d-overflow-inner",style:{height:e.getHeight()}},[i("img",{ref:"mainImage",style:e.getImageParams(),attrs:{src:e.getImage,alt:"",title:e.lang("Одно нажатие мышкой - изменение размера. Двойной щелчок мышкой - включает возможности по обрезке.")}})]),e._v(" "),e.isInEditWidthMode()?[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showImageLoading,expression:"showImageLoading"}],staticClass:"d-loading"})]:e._e()],2),e._v(" "),e.isNeedButtonShow?i("a",{staticClass:"d-button d-button-upload",attrs:{title:e.lang("Загрузить фото")},on:e._d({},[e.$clickevent,function(t){return t.preventDefault(),t.stopPropagation(),e.openImageDialog(t)}])}):e._e(),e._v(" "),e.isNeedButtonShow?i("a",{staticClass:"d-button d-button-menu",attrs:{title:e.lang("Открыть панель редактирования")},on:e._d({},[e.$clickevent,function(t){return t.preventDefault(),t.stopPropagation(),e.openAtom(t)}])}):e._e(),e._v(" "),e.isNeedButtonShow?i("a",{staticClass:"d-button d-button-crop",attrs:{title:e.lang("Обрезать фото")},on:e._d({},[e.$clickevent,function(t){return t.preventDefault(),t.stopPropagation(),e.showCropHandlers(t)}])}):e._e(),e._v(" "),e.isInEditWidthMode()&&!this.isSVGImage?i("a",{staticClass:"d-round-width-handler d-bottom",class:{"active-handler":e.isInEditWidthMode()},on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),e.startDragHeight(t))},"&touchstart":function(t){return t.stopPropagation(),e.startDragHeight(t)}}}):e._e()])])])],1)};s._withStripped=!0;var a=i(100),o=i(366),n=i(30);class d extends n.a{saveCroppedImage(e,t,i){let s=window.global.designer.image.saveAtomCroppedImageUrl,a={block_id:e,id:t,imageData:i};return this.makePOSTRequest(s,a)}saveAtomUploadedImageByUrl(e,t,i){let s=window.global.designer.image.saveAtomUploadedImageByUrl,a={block_id:e,id:t,image_url:i};return this.makePOSTRequest(s,a)}getDefaultAtomImageUrl(e,t){let i=window.global.designer.image.createDefaultAtomImageUrl,s={block_id:e,id:t};return this.makePOSTRequest(i,s)}changeImageByRatioForAtomImage(e,t,i){let s=window.global.designer.image.changeImageForAtomImageByRatioUrl,a={block_id:e,id:t,ratio:i};return this.makePOSTRequest(s,a)}changeImageByHeightAndWidthForAtomImage(e,t,i,s){let a=window.global.designer.image.changeImageForAtomImageByHeightAndWidthUrl,o={block_id:e,id:t,width:i,height:s};return this.makePOSTRequest(a,o)}}var l=i(386),r=i(1);const h=new d;var m={data:()=>({isWithPaddingClass:!1,isSVGImage:!1,editMode:"none",isNeedButtonShow:!0,changedHeight:"auto",imageRandom:null,touchTime:0,dialogOptions:{name:"upload",adaptive:!0,scrollable:!0,width:"80%",minWidth:300,maxWidth:800,height:"auto"}}),mounted(){let e=this.getData();e.attrs.src.value.length||h.getDefaultAtomImageUrl(this.blockId,this.itemId).then(t=>{e.attrs.src.value=t.data.copy,e.attrs.original.value=t.data.original,this.setAtomData(e)}),this.updateSVGImageSign(),document.getElementById(this.getAtomIdByBlockId()).addEventListener("atom-image-image-uploaded",this.newImageOnUpload),document.addEventListener(this.$clickevent,this.disableClickEditImage),document.addEventListener("designer.new-preset-played",this.onNewPresetAply)},beforeDestroy(){let e=document.getElementById(this.getAtomIdByBlockId());e&&e.removeEventListener("atom-image-image-uploaded",this.newImageOnUpload),document.removeEventListener(this.$clickevent,this.disableClickEditImage),document.removeEventListener("designer.new-preset-played",this.onNewPresetAply),this.removeRowEditClass()},methods:{clickChooseModeToEnable(e){this.need_crop||(0==this.touchTime?(this.showSizeHandlers(e),this.touchTime=(new Date).getTime()):(new Date).getTime()-this.touchTime<800?(this.showCropHandlers(e),this.touchTime=0):(this.touchTime=(new Date).getTime(),this.showSizeHandlers(e)))},openImageDialog(){this.$modal.show(l.default,{elementId:this.getAtomIdByBlockId(),item:this.getData()},this.dialogOptions),r.b.isAtomCanBeDeletedByButton()&&this.body.removeEventListener("keyup",this.checkDeleteAtom)},openAtom(){this.openAtomParams(),r.b.isAtomCanBeDeletedByButton()&&this.body.removeEventListener("keyup",this.checkDeleteAtom)},newImageOnUpload(e){let t=e.detail;h.saveAtomUploadedImageByUrl(this.blockId,this.itemId,t.url).then(e=>{let t=this.getData();this.imageRandom=Math.random(),t.attrs.src.value=e.data.copy,t.attrs.original.value=e.data.original,t.css.width.value="",t.css.height.value="",this.updateSVGImageSign(),this.isSVGImage&&(t.css.width.value="150px"),this.isWithPaddingClass=!1,this.setAtomData(t)})},disableClickEditImage(e){e.target.closest("#"+this.getAtomIdByBlockId())||this.body.classList.contains("d-edit-mode")||(this.needSetHeight&&this.crop(),this.editMode="none",this.need_crop=!1,this.needSetHeight=!1,this.removeRowEditClass(),this.setColumnDraggable(!0))},getRowId(){return"d-row-"+this.blockId},getImageExtension:e=>e.split(".").pop(),updateSVGImageSign(){this.isSVGImage="svg"==this.getImageExtension(this.getOriginalImage.toString())},onNewPresetAply(e){e.detail.block_id==this.blockId&&this.updateSVGImageSign()}},computed:{getImage(){let e=this.getAttrValue("src");return e.length>0?(this.imageRandom&&-1==e.indexOf("base64")&&(e+="?v="+this.imageRandom),e):window.global.designer.imageDefaultPicture},getOriginalImage(){let e=this.getAttrValue("original");return e.length>0?e:window.global.designer.imageDefaultPicture}}},g=i(7);const c=new d;var u={data:()=>({atom:null,block:null,image:null,original:null,isWithPaddingClass:!1,editMode:"none",leftPixels:"0px",minSizes:70,imageTop:null,canMoveWidth:!0,changedHeight:"auto",changedScale:null,showImageLoading:!1,imageNaturalHeight:null,imageCurrentHeight:null,widthDragSide:null,widthDragStep:10,columnWidth:null,columnMiddle:null,positionType:"center"}),mounted(){let e=this.getData();e.css["align-self"]&&(this.positionType=e.css["align-self"].value),e.css.height.value&&(this.changedHeight=e.css.height.value),r.b.isAtomCanBeDeletedByButton()&&this.body.addEventListener("designer.atom-image-delete-atom-remove",this.checkDeleteAtomEvent),document.addEventListener("designer.change-align-self",this.alignPositionChange)},beforeDestroy(){this.removeRowEditClass(),this.body.removeEventListener("keyup",this.checkDeleteAtom),r.b.isAtomCanBeDeletedByButton()&&this.body.removeEventListener("designer.atom-image-delete-atom-remove",this.checkDeleteAtomEvent),this.setColumnDraggable(!0),document.removeEventListener("designer.change-align-self",this.alignPositionChange)},methods:{showSizeHandlers(e){r.b.closeAllPanels(),this.addRowEditClass(),this.editMode="editSize";let t=e.target.closest(".designer-col");this.columnWidth=t.getBoundingClientRect().width;let i=this.$refs.mainImageInnerWrapper.getBoundingClientRect().width,s=this.$refs.mainImage.getBoundingClientRect().width;if(i>s&&(i=s),this.isWithPaddingClass=!(this.columnWidth-i<=20),this.setColumnDraggable(!1),this.setOpenHover(),r.b.isAtomCanBeDeletedByButton()){let e=new CustomEvent("designer.atom-image-delete-atom-remove",{detail:{itemId:this.itemId}});this.body.dispatchEvent(e),setTimeout(()=>{this.body.addEventListener("keyup",this.checkDeleteAtom)},100)}},checkDeleteAtomEvent(e){e.detail.itemId!=this.itemId&&this.body.removeEventListener("keyup",this.checkDeleteAtom)},getImageParams(){let e=this.getData().css.width.value;e.length||(e="100%");let t={width:e};return this.changedScale&&!this.isSVGImage&&(t.transform="scale("+this.changedScale+")"),t},getWidth(){let e=this.getData().css.width.value;return e.length||(e="100%"),{width:e}},getHeight(){let e="auto";return this.changedHeight&&(e=this.changedHeight),e},alignPositionChange(e){e.detail.itemId==this.itemId&&(this.atom=this.getData(),this.positionType=this.atom.css["align-self"].value)},isInEditWidthMode(){return"editSize"==this.editMode},mouseDragWidthMove(e){if(!this.canMoveWidth)return;let t,i,s=r.b.getMouseOrTouchMoveCoordinate(e,"x");switch(this.positionType){case"center":t="left"==this.widthDragSide?this.columnMiddle-s:s-this.columnMiddle,i=2*(t-t%this.widthDragStep)+20;break;case"flex-start":case"flex-end":t=Math.abs(this.columnMiddle-s),i=t-t%this.widthDragStep}i<this.minSizes&&(i=this.minSizes);let a=this.columnWidth-i;if(a=Math.round(a),a>20?(this.isWithPaddingClass=!0,this.leftPixels=i+"px"):this.isWithPaddingClass=!1,i>this.columnWidth&&(i=""),"auto"!=this.changedHeight){let e=parseInt(this.changedHeight,10);if(this.$refs.mainImage.getBoundingClientRect().height<=e){let e=this.getData();this.changedHeight="auto",e.css.height.value="",this.setAtomData(e)}}this.atom.css.width.value=i?i+"px":i},showResizerHandler(e){if("left"==e)switch(this.positionType){case"center":case"flex-start":return!0;case"flex-end":return!1}if("right"==e)switch(this.positionType){case"center":case"flex-end":return!0;case"flex-start":return!1}return!1},stopDragWidth(e){this.body.removeEventListener(this.$mouseup,this.stopDragWidth),this.body.removeEventListener(this.$mousemove,this.mouseDragWidthMove),this.setAtomData(this.atom),this.isNeedButtonShow=!0,this.removeRowEditClass(),this.body.classList.remove("d-edit-mode")},startDragWidth(e,t){this.atom=this.getData();let i=e.target.closest(".designer-col");switch(this.columnWidth=i.getBoundingClientRect().width,this.positionType){case"flex-start":this.columnMiddle=i.getBoundingClientRect().left;break;case"center":this.columnMiddle=i.getBoundingClientRect().left+this.columnWidth/2;break;case"flex-end":this.columnMiddle=i.getBoundingClientRect().left+this.columnWidth}this.body.addEventListener(this.$mouseup,this.stopDragWidth),this.body.addEventListener(this.$mousemove,this.mouseDragWidthMove),this.widthDragSide=t,e.stopPropagation(),this.isNeedButtonShow=!1,this.body.classList.add("d-edit-mode")},mouseDragHeightMove(e){let t=r.b.getMouseOrTouchMoveCoordinate(e,"y")-this.imageTop,i=null;t>this.imageNaturalHeight&&(i=t/this.imageNaturalHeight),t<this.minSizes&&(t=this.minSizes),this.changedScale=i,this.changedHeight=t+"px"},applyCuttedImageCopy(e,t){this.setAtomAttributeDataWithoutRequest({id:this.itemId,attrs:{src:e.data.copy+"?v="+Math.random()}}),this.canMoveWidth=!0,this.changedScale=null,this.showImageLoading=!1},sendImageWidthHeightChange(){this.$refs.mainImage.removeEventListener("load",this.sendImageWidthHeightChange);let e=this.getData(),t=e.css.width.value;if(this.setAtomData(e),e.css.height.value.length&&!t.toString().length)return this.canMoveWidth=!0,void(this.changedScale=null);if(this.canMoveWidth=!1,this.showImageLoading=!0,e.css.height.value.length)c.changeImageByHeightAndWidthForAtomImage(this.blockId,this.itemId,t,e.css.height.value).then(this.applyCuttedImageCopy);else{t.toString().length&&"100%"!=t||(t=this.$refs.mainImage.closest(".designer-col").getBoundingClientRect().width);let e=parseInt(t,10)/this.imageCurrentHeight;c.changeImageByRatioForAtomImage(this.blockId,this.itemId,e).then(this.applyCuttedImageCopy)}},eventChangeWidthOfImage(e){e.target.closest(".d-round-width-handler.active-handler")||(document.removeEventListener("click",this.eventChangeWidthOfImage),this.$refs.mainImage&&this.$refs.mainImage.addEventListener("load",this.sendImageWidthHeightChange))},stopDragHeight(e){if(this.$refs.mainImage){let e=this.changedHeight,t=this.$refs.mainImage.getBoundingClientRect().height;"auto"==e&&(e=t),e=parseInt(e,10);let i=this.getData();this.changedScale?i.css.height.value="":i.css.height.value=e+"px",this.imageCurrentHeight=e}this.body.removeEventListener(this.$mouseup,this.stopDrag),this.body.removeEventListener(this.$mousemove,this.mouseDragHeightMove),this.isNeedButtonShow=!0,this.removeRowEditClass(),this.body.classList.remove("d-edit-mode")},calcNaturalHeight(){let e=this.$refs.mainImage,t=e.naturalHeight,i=e.naturalWidth,s=e.width,a=i/t;this.imageNaturalHeight=Math.trunc(s/a)},startDragHeight(e){this.setAtomAttributeDataWithoutRequest({id:this.itemId,attrs:{src:this.getOriginalImage.toString()}}),this.$refs.mainImage.addEventListener("load",this.calcNaturalHeight),this.atom=this.getData();let t=e.target.closest(".designer-col");this.columnWidth=t.getBoundingClientRect().width,this.imageTop=this.$refs.mainImageWrapper.getBoundingClientRect().top,this.calcNaturalHeight(),this.body.addEventListener(this.$mouseup,this.stopDragHeight),this.body.addEventListener(this.$mousemove,this.mouseDragHeightMove),document.removeEventListener(this.$clickevent,this.eventChangeWidthOfImage),document.addEventListener(this.$clickevent,this.eventChangeWidthOfImage),this.isNeedButtonShow=!1,this.body.classList.add("d-edit-mode")},...Object(g.b)("blocks",["setAtomAttributeDataWithoutRequest"])}},p=i(101),v=i(99);const b=new d;var I={data:()=>({viewportHeight:null,viewportWidth:null,boundaryHeight:null,boundaryWidth:null,oldImageUrl:null,needSetHeight:!1,need_crop:!1}),updated(){this.needSetHeight&&this.$refs.croppieRef.bind({url:this.getImage.toString()})},methods:{showCropHandlers(){r.b.closeAllPanels(),this.oldImageUrl=this.getImage.toString().split("?")[0],"svg"!=this.getImageExtension(this.getImage.toString())&&(this.needSetHeight||(this.setViewportParams(),this.needSetHeight=!0,this.need_crop=!0,document.addEventListener("click",this.addEventToSaveCrop),this.body.removeEventListener(this.$mouseup,this.stopDragHeight),this.isNeedButtonShow=!1,this.body.classList.add("d-edit-mode"),this.body.removeEventListener("keyup",this.checkDeleteAtom)))},addEventToSaveCrop(e){e.target.closest("#"+this.getAtomIdByBlockId())||this.body.classList.contains("d-edit-mode")||this.crop()},disableCrop(){document.removeEventListener("click",this.addEventToSaveCrop),this.needSetHeight=!1,this.need_crop=!1},setViewportParams(){let e=this.getData();e.css.height.value?this.boundaryHeight=parseFloat(e.css.height.value):this.boundaryHeight=this.$refs.mainImage.getBoundingClientRect().height,this.viewportHeight=this.boundaryHeight,e.css.height.width?this.boundaryWidth=parseFloat(e.css.height.width):this.boundaryWidth=this.$refs.mainImage.getBoundingClientRect().width,this.viewportWidth=this.boundaryWidth},addCropEditMode(){document.addEventListener(this.$mouseup,this.removeCropEditMode)},removeCropEditMode(){document.removeEventListener(this.$mouseup,this.removeCropEditMode)},crop(){this.imageRandom=Math.random();let e=this.$refs.croppieRef.croppie.element.querySelector(".cr-viewport"),t=e.getBoundingClientRect(),i=e.closest(".d-atom-image-crop-wrapper").getBoundingClientRect(),s=i.width,a=i.height,o=t.width,n=t.height;if(this.isNeedButtonShow=!0,s==o&&a==n)return document.removeEventListener("click",this.addEventToSaveCrop),this.needSetHeight=!1,void(this.need_crop=!1);this.$refs.croppieRef.result({format:"jpeg",size:"viewport",backgroundColor:"#fff"},e=>{this.setAtomAttributeDataWithoutRequest({id:this.itemId,attrs:{src:e}}),this.disableCrop(),b.saveCroppedImage(this.blockId,this.itemId,e);let t=this.getData();this.changedHeight=n,t.css.height.value=n+"px",t.css.width.value=o+"px",this.setAtomData(t)})}}},y={name:"AtomImage",mixins:[o.a,m,u,I,p.a,v.a,a.a],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>i.e(21).then(i.bind(null,421)),ImageUploadDirect:()=>Promise.resolve().then(i.bind(null,386))}},w=i(98),f=Object(w.a)(y,s,[],!1,null,null,null);f.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/image/image.vue";t.default=f.exports}}]);