(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{371:function(e,i,t){"use strict";t.d(i,"a",(function(){return l}));var s=t(30),a=t(51);class l extends s.a{loadSVGIcons(e){return this.makeGETRequest(window.global.designer.svgIconsURL).then(i=>{let t=i.list,s=[];return s.push(e),t&&t.length&&t.forEach(e=>{-1==s.indexOf(e.category)&&s.push(e.category)}),{icons:t,categories:s}})}loadPixabayImages(e,i,t,s){let l={term:e,category:i,p:t};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.pixabayImageSearchUrl,l)).then(e=>{let i=!1;if(e){let t=e.list;t&&t.length?t.forEach(e=>{s.push(e)}):i=!0}else a.a.showSimpleMessage(lang.t("Не удалось получить данные от сервера Pixabay")),i=!0;return{isEnd:i,visibleIcons:s}})}saveImageByURL(e){let i={url:e};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.saveImageByUrl,i))}deleteMediaFileByFileName(e){let i={file:e};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.deleteFileUrl,i))}deleteMediaImageByFileName(e){let i={file:e};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.deleteImageUrl,i))}loadMoreMediaFiles(e,i){let t={p:i};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.getUploadedFilesUrl,t)).then(i=>{let t=!1,s=i.list;return s&&s.length?s.forEach(i=>{e.push(i)}):t=!0,{isEnd:t,visibleIcons:e}})}loadMoreImageFiles(e,i){let t={p:i};return this.makeGETRequest(this.createUrlWithParams(window.global.designer.getUploadedImagesUrl,t)).then(i=>{let t=!1,s=i.list;return s&&s.length?s.forEach(i=>{e.push(i)}):t=!0,{isEnd:t,visibleIcons:e}})}}},374:function(e,i,t){"use strict";const s=new(t(371).a);i.a={data:()=>({iconsLoaded:!1,inLoading:!1,isEnd:!1,curpage:0,visibleIcons:[]}),methods:{onScrollEnd(){if(this.inLoading||this.isEnd)return;let e=this.$refs.imageWrapper;e.offsetHeight+e.scrollTop>=e.scrollHeight-20&&this.loadMore()},onSearch(){this.term=this.$refs.searchInput.value,this.visibleIcons=[],this.curpage=0,this.inLoading=!1,this.isEnd=!1,this.loadMore()},onCategorySelect(e){this.current_category=e.target.value,this.visibleIcons=[],this.curpage=0,this.inLoading=!1,this.isEnd=!1,this.loadMore()},openUrl(e){window.open(e,"_blank")},saveImage(){this.$emit("save-image",this.files[0].url)},addHover(e){e.target.classList.toggle("hover")},saveImageByUrl(e,i){e.target.classList.contains("d-open")||(this.iconsLoaded=!1,s.saveImageByURL(i).then(e=>{this.$emit("save-image",e.url)}).catch(e=>{console.error(e.message),this.iconsLoaded=!0}))}}}},399:function(e,i,t){"use strict";t.r(i);var s=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"d-upload-list-wrapper"},[t("div",{ref:"imageWrapper",staticClass:"d-images-container",on:{"&scroll":function(i){return e.onScrollEnd(i)}}},[e.iconsLoaded?[e.visibleIcons.length?t("div",{staticClass:"d-images-container-wrapper",attrs:{id:"imageFiles"}},[e._l(e.visibleIcons,(function(i,s){return[t("a",{staticClass:"d-select-svg d-big"},[t("div",{staticClass:"d-image-container d-big",style:{backgroundImage:"url("+i.url+")"},on:{click:function(t){return e.saveImage(t,i.url)}}},[t("div",{staticClass:"d-image-buttons"},[t("a",{staticClass:"d-open",attrs:{href:i.url,title:e.lang("Открыть")}},[t("img",{staticStyle:{display:"none"},attrs:{src:i.url,alt:""}})])]),e._v(" "),i.width?t("div",{staticClass:"d-sizes"},[e._v(e._s(i.width)+"x"+e._s(i.height))]):e._e(),e._v(" "),t("span",{staticClass:"d-delete",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.deleteImageFile(i,s)}}})])])]}))],2):e._e()]:e._e(),e._v(" "),e.iconsLoaded&&!e.visibleIcons.length?t("div",{staticClass:"d-empty-message"},[t("span",[e._v(e._s(e.lang("Здесь будут изображения загруженные ранее")))])]):e._e(),e._v(" "),e.iconsLoaded?e._e():t("div",{staticClass:"d-empty-message"},[t("span",[e._v(e._s(e.lang("Подождите...")))])])],2)])};s._withStripped=!0;var a=t(374),l=t(365),n=t(371);const r=new n.a;var o={mounted(){this.loadMore()},methods:{deleteFile(e,i){confirm(lang.t("Удалить файл?"))&&(this.inLoading=!0,r.deleteMediaFileByFileName(e.title).then(e=>{this.inLoading=!1,this.visibleIcons.splice(i,1)}))},deleteImageFile(e,i){confirm(lang.t("Удалить файл?"))&&(this.inLoading=!0,r.deleteMediaImageByFileName(e.title).then(e=>{this.inLoading=!1,this.visibleIcons.splice(i,1)}))},_prepareLoadMoreResult(e){this.iconsLoaded=!0,this.inLoading=!1,this.isEnd=e.isEnd,this.visibleIcons=e.visibleIcons},loadMore(){switch(this.inLoading=!0,this.curpage++,this.loadType){case"image":r.loadMoreImageFiles(this.visibleIcons,this.curpage).then(this._prepareLoadMoreResult);break;case"files":r.loadMoreMediaFiles(this.visibleIcons,this.curpage).then(this._prepareLoadMoreResult)}}}};const d=new n.a;var c={data:()=>({actionUrl:window.global.designer.getUploadedImagesUrl,loadType:"image",lightGallery:null}),methods:{saveImage(e,i){e.target.classList.contains("d-open")||this.$emit("save-image",i)},initOpenGallery(){setTimeout(()=>{this.lightGallery=document.querySelector("#imageFiles"),window.lgData&&window.lgData[this.lightGallery.getAttribute("lg-uid")]&&window.lgData[this.lightGallery.getAttribute("lg-uid")].destroy(!0),lightGallery(this.lightGallery,{selector:".d-open",thumbnail:!0})},200)},loadMore(){switch(this.inLoading=!0,this.curpage++,this.loadType){case"image":d.loadMoreImageFiles(this.visibleIcons,this.curpage).then(e=>{this._prepareLoadMoreResult(e),this.initOpenGallery()});break;case"files":d.loadMoreMediaFiles(this.visibleIcons,this.curpage).then(this._prepareLoadMoreResult)}}}},h={name:"ImageFiles",mixins:[l.a,a.a,o,c]},g=t(98),u=Object(g.a)(h,s,[],!1,null,null,null);u.options.__file="-readyscript/modules/designer/view/js/app/src/components/leftpanel/controls/upload/imagefiles/imagefiles.vue";i.default=u.exports}}]);