(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{366:function(t,e,o){"use strict";var s=o(7),i=o(156);o(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(o){console.info("name",t),console.info("attr",e),console.error(o)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(o=>{t[o]&&e.push("d-hidden-"+o)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}i.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,o=t.tag,s=this.getStyle,i=[],r=[];Object.keys(s).forEach(t=>{"padding-top"==t||"padding-bottom"==t?r.push(t+":"+s[t]):i.push(t+":"+s[t])});let d=this.getClass;return`<div style="${r.join(";")}"><${o} id="${this.getAtomTagId()}" class="${d} ${this.getAtomIdByBlockId()}" style="${i.join(";")}">${e}</${o}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let o=this.getData();o.css[t].value=e,this.setAtomData(o)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(s.b)(["closeLastPanel"]),...Object(s.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,o=t.tag;return`<${o} class="${this.getAtomIdByBlockId()}">${e}</${o}>`},contentWithoutClass(){let t=this.getData(),e=t.html,o=t.tag,s="";return this.getSpecialStyles&&(s="style='"+this.getSpecialStyles()+"'"),`<${o} ${s}>${e}</${o}>`},...Object(s.c)("blocks",["getAtomData"]),...Object(s.c)(["getMenuStack"])}}},367:function(t,e,o){"use strict";e.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(t){let e=t.split("/").pop().replace(".","_");if(!window[e+"_loaded"]){let o=document.createElement("script");o.type="text/javascript",o.src=t,document.body.appendChild(o),window[e+"_loaded"]=1}},loadExternalCSS(t){let e=t.split("/").pop().replace(".","_");window[e+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${t}" type="text/css" rel="stylesheet"/>\n               `))}}}},388:function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:t.getHiddenClasses()},[o("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),o("div",{ref:"thisAtom",staticClass:"d-atom",attrs:{id:t.getAtomIdByBlockId()},on:{click:function(e){return e.preventDefault(),t.openAtomProductParams(e)}}},[o("div",{staticClass:"d-atom-instance d-atom-product"},[t.inLoading?[o("div",{staticClass:"d-atom-form"},[o("div",{staticClass:"d-in-loading"},[t._v(t._s(t.lang("Подождите...")))])])]:[t.getProduct?[o("div",{staticClass:"d-atom-product-zone",class:t.getAtomClass()},[o("WidthResize",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),o("div",{staticClass:"d-row d-product-row",attrs:{"data-id":t.product.id}},["top"==t.getAttrValue("header_show_place")?o("div",{staticClass:"d-col-12"},[o("div",{domProps:{innerHTML:t._s(t.productHeader())}})]):t._e(),t._v(" "),t.getAttrValue("show_photos")?o("div",{staticClass:"d-col-12",class:t.getPanelColSize("left"),on:t._d({},[t.$clickevent,function(t){t.stopPropagation(),t.preventDefault()}])},[o("div",{staticClass:"d-top-swiper"},[o("div",{staticClass:"swiper-container",attrs:{id:t.getAtomSwiperId()}},[o("div",{staticClass:"swiper-wrapper"},[t._l(t.getProductPhotos(),(function(e,s){return[o("div",{staticClass:"swiper-slide"},[o("a",{attrs:{"data-src":t.product.photos.big[s]}},[o("img",{attrs:{src:e,alt:""}})])])]}))],2),t._v(" "),t.getAttrValue("photo_show_pagination")&&t.getProductPhotos().length>1?o("div",{staticClass:"swiper-pagination",attrs:{id:t.getAtomSwiperPaginationId()}}):t._e(),t._v(" "),t.getProductPhotos().length>1?[o("div",{staticClass:"swiper-button-next d-swiper-arrow",attrs:{id:t.getAtomSwiperButtonId("next")}}),t._v(" "),o("div",{staticClass:"swiper-button-prev d-swiper-arrow",attrs:{id:t.getAtomSwiperButtonId("prev")}})]:t._e()],2)]),t._v(" "),t.getAttrValue("show_thumbs")&&t.getProductPhotos().length>1?o("div",{staticClass:"d-product-swiper-thumbs-wrapper"},[o("div",{staticClass:"swiper-container swiper-wrapper-thumbs",attrs:{id:t.getAtomSwiperThumbsId()}},[o("div",{staticClass:"swiper-wrapper"},t._l(t.getProductPhotos("thumbs"),(function(t,e){return o("div",{key:e,staticClass:"swiper-slide"},[o("a",[o("img",{attrs:{src:t,alt:""}})])])})),0),t._v(" "),t.getAttrValue("show_thumb_arrows")?[o("div",{staticClass:"swiper-button-next d-swiper-arrow",attrs:{id:t.getAtomSwiperThumbsButtonId("next")}}),t._v(" "),o("div",{staticClass:"swiper-button-prev d-swiper-arrow",attrs:{id:t.getAtomSwiperThumbsButtonId("prev")}})]:t._e()],2)]):t._e()]):t._e(),t._v(" "),t.getAttrValue("show_product")?o("div",{staticClass:"d-col-12",class:t.getPanelColSize("right")},[o("div",{staticClass:"d-atom-product-right"},["right"==t.getAttrValue("header_show_place")?o("div",{domProps:{innerHTML:t._s(t.productHeader())}}):t._e(),t._v(" "),t.showOfferTitle()?o("div",{staticClass:"d-atom-product-subheader"},[t._v(t._s(t.showOfferCapture())+": "+t._s(t.product.offer.title))]):t._e(),t._v(" "),t.getAttrValue("show_barcode")&&t.product.barcode?o("div",{staticClass:"d-atom-product-barcode"},[t._v(t._s(t.lang("Артикул"))+": "+t._s(t.product.barcode))]):t._e(),t._v(" "),t.getAttrValue("show_brand")&&t.product.brand&&t.product.brand.length?o("div",{staticClass:"d-atom-product-brand"},[t._v(t._s(t.lang("Бренд"))+": "+t._s(t.product.brand))]):t._e(),t._v(" "),t.showShortDescription()?o("div",{staticClass:"d-atom-product-shortdescription"},[t._v(t._s(t.product.short_description))]):t._e(),t._v(" "),t.showOldCost()?o("div",{staticClass:"d-atom-product-old-cost"},[t._v(t._s(t.product.old_cost)+" "+t._s(t.product.currency))]):t._e(),t._v(" "),t.getAttrValue("show_price")?o("div",{staticClass:"d-atom-product-cost"},[t._v(t._s(t.product.cost)+" "+t._s(t.product.currency))]):t._e(),t._v(" "),t.getAttrValue("show_amount")&&t.product.amount?o("div",{staticClass:"d-atom-product-amount-wrapper"},[o("input",{staticClass:"d-atom-product-amount",attrs:{type:"number",min:t.product.amount.min,step:t.product.amount.step},domProps:{value:t.product.amount.min}})]):t._e(),t._v(" "),t.getAttrValue("show_stock")?[t.showInStock()?o("div",{staticClass:"d-atom-product-instock"},[t._v(t._s(t.lang("В наличии")))]):o("div",{staticClass:"d-atom-product-instock-red"},[t._v(t._s(t.lang("Не в наличии")))])]:t._e(),t._v(" "),t.getAttrValue("show_buttons")?o("div",{staticClass:"d-atom-product-button-wrapper"},[t.getAttrValue("show_buy_button")?[t.showBuyButton()?o("a",{staticClass:"d-atom-product-button",attrs:{title:t.lang("В корзину")},domProps:{innerHTML:t._s(t.getBuyButtonText())}}):t._e(),t._v(" "),t.showReservationButton()?o("a",{staticClass:"d-atom-product-button-order",attrs:{title:t.lang("Заказать")},domProps:{innerHTML:t._s(t.getReservationButtonText())}}):t._e()]:t._e(),t._v(" "),t.showBuyOneClickButton()?o("a",{staticClass:"d-atom-product-button-buy-one-click",attrs:{title:t.lang("Купить в 1 клик")},domProps:{innerHTML:t._s(t.getOneClickButtonText())}}):t._e()],2):t._e()],2)]):t._e()]),t._v(" "),t.getAttrValue("show_product")&&t.getAttrValue("show_description")?o("div",{staticClass:"d-row d-product-row"},[o("div",{staticClass:"d-col-12"},[o("div",{staticClass:"d-atom-product-description",domProps:{innerHTML:t._s(t.product.description)}})])]):t._e()],1)]:o("div",{staticClass:"d-atom-no-product"},[t.getProductId?o("div",{staticClass:"d-atom-none-select"},[o("div",{staticClass:"d-atom-none-select-select-wrapper"},[o("div",{staticClass:"d-no-product-title"},[t._v(t._s(t.product.title))]),t._v(" "),o("p",[t._v(t._s(t.lang("Выберите комплектацию:")))]),t._v(" "),o("select",{ref:"offerSelect",staticClass:"d-atom-none-select-form-select"},[t._l(t.offers,(function(e,s){return[o("option",{domProps:{value:s}},[t._v(t._s(e.title))])]}))],2)]),t._v(" "),o("a",{staticClass:"d-green-button",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.onOfferSelect(e)}}},[t._v(t._s(t.lang("Выбрать")))])]):o("div",{staticClass:"d-atom-none-select hide-group-cb",attrs:{id:t.getAtomIdButtonByBlockId(),"data-urls":t.getProductDialogOptions()}},[o("a",{staticClass:"d-green-button openDDialog",on:{click:function(e){return e.preventDefault(),t.selectProduct()}}},[t._v(t._s(t.lang("Выбрать товар")))]),t._v(" "),o("a",{staticClass:"d-gray-button",attrs:{href:t.addProductHref(),target:"_blank"},on:{click:function(t){t.stopPropagation()}}},[t._v(t._s(t.lang("Добавить товар")))])])])]],2)])],1)};s._withStripped=!0;var i=o(366),r=o(30);class d extends r.a{getProduct(t,e,o){let s={product_id:t,offer:e,photo:o},i=this.createUrlWithParams(window.global.designer.product.getProductByIdUrl,s);return this.makeGETRequest(i)}getOffers(t){let e={product_id:t},o=this.createUrlWithParams(window.global.designer.product.getOffersByProductIdUrl,e);return this.makeGETRequest(o)}}const a=new d;var n={data:()=>({inLoading:!1,product:{},offers:[],offer:{},load_js:[window.global.designer.productselect_js_url,window.global.designer.swiper_js_url,window.global.designer.lightgallery_js_url],load_css:[window.global.designer.productselect_css_url,window.global.designer.swiper_css_url,window.global.designer.lightgallery_css_url]}),mounted(){this.getProductId||($.selectProduct?this.addEventToSelectProduct():this.body.addEventListener("product-select.inited",this.addEventToSelectProduct)),this.getProduct?this.uploadProductInfo(this.getProductId,this.getOfferSortn):this.getProductId&&this.uploadOffersInfo(this.getProductId)},beforeDestroy(){this.body.removeEventListener("product-select.inited",this.addEventToSelectProduct)},updated(){this.getProductId||this.addEventToSelectProduct()},methods:{openAtomProductParams(){this.body.removeEventListener("keyup",this.checkDeleteAtom),this.getProduct?this.openAtomParams():(this.setOpenHover(),this.body.addEventListener("keyup",this.checkDeleteAtom))},onOfferSelect(t){let e=this.$refs.offerSelect.value,o=this.getData();o.offer_sortn=e,this.setAtomData(o),this.uploadProductInfo(o.product_id,e)},getPanelColSize(t){let e=[],o=this.getAttrs();return"horizontal"==o.type_show.value&&(e.push("d-col-md-6 d-col-lg-"+o[t+"_column"].value),"left"!=t||o.show_product.value||(e=[]),"right"!=t||o.show_photos.value||(e=[])),e},uploadOffersInfo(t){this.product={},this.offers=[],this.inLoading=!0,a.getOffers(t).then(e=>{if(this.inLoading=!1,e.success){this.product=e.product;let o=this.getData();o.product_id=t,e.offers?this.offers=e.offers:(o.offer_sortn=0,this.uploadProductInfo(t,0)),this.setAtomData(o)}})},uploadProductInfo(t,e){this.product={},this.offers=[],this.inLoading=!0;let o={};return o.width=parseInt(this.getAttrValue("photo_width"),10),o.height=parseInt(this.getAttrValue("photo_height"),10),o.big_width=parseInt(this.getAttrValue("photo_big_width"),10),o.big_height=parseInt(this.getAttrValue("photo_big_height"),10),o.type=this.getAttrValue("photo_type"),o.thumb_width=parseInt(this.getAttrValue("thumb_width"),10),o.thumb_height=parseInt(this.getAttrValue("thumb_height"),10),a.getProduct(t,e,o).then(t=>{this.inLoading=!1,t.success&&(this.product=t.product,this.offer=t.offer,this.slider?setTimeout(()=>{try{this.slider.update()}catch(t){console.error(t)}},300):this.initSlider())})},addEventToSelectProduct(){$.fn.selectProduct?$("#"+this.getAtomIdButtonByBlockId()).selectProduct({dialog:"productDesignerDialog",startButton:".openDDialog",onCheckProduct:(t,e,o)=>{this.uploadOffersInfo(t),o.dialog("close")}}):setTimeout(()=>{this.addEventToSelectProduct()},200)},selectProduct(){this.addEventToSelectProduct(),$("#"+this.getAtomIdButtonByBlockId()).click()},productHeader(){let t=this.getAttrs().header_tag.value;return`<${t} class="d-atom-product-header">${this.product.title}</${t}>`},showOfferTitle(){return!!this.product.has_offers&&this.getAttrValue("show_offer_title")},showOfferCapture(){return this.product.offer_caption.length?this.product.offer_caption:lang.t("Комплектация")},showInStock(){return!this.getAttrValue("show_not_in_stock")&&this.product.num>0},showBuyButton(){return!!this.getAttrValue("show_always_button_buy")||this.product.buttons&&-1!=Object.keys(this.product.buttons).indexOf("buy")},showReservationButton(){return!!this.getAttrValue("show_always_button_reservation")||this.product.buttons&&-1!=Object.keys(this.product.buttons).indexOf("reservation")},showBuyOneClickButton(){return!!this.getAttrValue("show_always_button_oneclick")||this.product.buttons&&-1!=Object.keys(this.product.buttons).indexOf("oneclick")},showShortDescription(){return this.getAttrValue("show_short_description")&&this.product.short_description&&this.product.short_description.length},showOldCost(){return this.getAttrValue("show_old_price")&&this.product.old_cost},getBuyButtonText(){let t="";return this.getAttrValue("show_buy_icon")&&(t='<span class="d-atom-product-icon-buy"></span>'),`${t} ${this.getAttrValue("buy_button_text")}`},getReservationButtonText(){let t="";return this.getAttrValue("show_reservation_icon")&&(t='<span class="d-atom-product-icon-reservation"></span>'),`${t} ${this.getAttrValue("reservation_button_text")}`},getOneClickButtonText(){let t="";return this.getAttrValue("show_oneclick_icon")&&(t='<span class="d-atom-product-icon-oneclick"></span>'),`${t} ${this.getAttrValue("oneclick_button_text")}`},getProductDialogOptions:()=>`{"getChild": "${window.global.designer.dialogs.catalog.getChildCategoryUrl}", "getProducts": "${window.global.designer.dialogs.catalog.getProductsUrl}", "getDialog": "${window.global.designer.dialogs.catalog.dialog}"}`,getAtomIdButtonByBlockId(){return"d-button-atom-"+this.blockId+"-"+this.itemId},addProductHref:()=>window.global.designer.product.productAddUrl},computed:{getProduct(){let t=this.getData();return t.product_id>0&&!1!==t.offer_sortn},getProductId(){return this.getData().product_id},getOfferSortn(){return this.getData().offer_sortn}}},l={data:()=>({slider:null,sliderThumbs:null}),mounted(){window.addEventListener("resize",this.reInitSlider),document.addEventListener("designer.product-reinit.slider",this.reInitSlider),document.addEventListener("designer.product-reinit.slider-reload",this.reload),document.addEventListener("designer.product-reinit.product-reload",this.reUploadProduct),document.addEventListener("designer.product-reinit.product-change-panel",this.changeLeftPanel)},beforeDestroy(){window.removeEventListener("resize",this.reInitSlider),document.removeEventListener("designer.product-reinit.slider",this.reInitSlider),document.removeEventListener("designer.product-reinit.slider-reload",this.reload),document.removeEventListener("designer.product-reinit.product-reload",this.reUploadProduct),document.removeEventListener("designer.product-reinit.product-change-panel",this.changeLeftPanel)},updated(){this.reInitSlider()},methods:{getAtomSwiperId(){return"d-swiper-"+this.blockId+"-"+this.itemId},getAtomSwiperThumbsId(){return"d-swiper-thumbs-"+this.blockId+"-"+this.itemId},getAtomSwiperPaginationId(){return"d-swiper-pagination-"+this.blockId+"-"+this.itemId},getAtomSwiperButtonId(t){return"d-swiper-"+t+"-"+this.blockId+"-"+this.itemId},getAtomSwiperThumbsButtonId(t){return"d-swiper-thumbs-"+t+"-"+this.blockId+"-"+this.itemId},getBigSlideStyle(t){return{"background-image":"url("+t+")",height:this.getAttrValue("photo_height")}},initSlider(){let t={lazy:!0,effect:this.getAttrValue("photo_effect"),grabCursor:!0},e=this.getProductPhotos().length;e>1&&(t.navigation={nextEl:"#"+this.getAtomSwiperButtonId("next"),prevEl:"#"+this.getAtomSwiperButtonId("prev")}),this.getAttrValue("photo_show_loop")&&(t.loop=!0),this.getAttrValue("photo_show_pagination")&&e>1&&(t.pagination={el:"#"+this.getAtomSwiperPaginationId(),clickable:!0}),this.getAttrValue("photo_autoplay")&&(t.autoplay={delay:this.getAttrValue("photo_autoplay_speed"),disableOnInteraction:!1});let o,s=!1;if(this.getAttrValue("show_thumbs")&&e>1){let e=this.getAttrValue("thumb_count");if(window.screen.width<=767){let t=this.getAttrValue("thumb_width"),o=window.screen.width;e=Math.floor((o-40)/parseInt(t,10))}s={grabCursor:!0,autoHeight:!0,slidesPerView:e,loopedSlides:e,freeMode:!0,watchSlidesVisibility:!0,watchSlidesProgress:!0},this.getAttrValue("show_thumb_arrows")&&(s.navigation={nextEl:"#"+this.getAtomSwiperThumbsButtonId("next"),prevEl:"#"+this.getAtomSwiperThumbsButtonId("prev")}),t.loopedSlides=e}o="undefined"==typeof Swiper?setInterval(()=>{"undefined"!=typeof Swiper&&(clearInterval(o),this.setSlider(t,s))},100):setTimeout(()=>{clearTimeout(o),this.setSlider(t,s)},500)},setSlider(t,e){e&&(this.sliderThumbs=new Swiper("#"+this.getAtomSwiperThumbsId(),e),t.thumbs={swiper:this.sliderThumbs});let o="#"+this.getAtomSwiperId();this.slider=new Swiper(o,t);let s=document.querySelector(o);"undefined"!=typeof lightGallery&&lightGallery(s,{selector:".swiper-slide:not(.swiper-slide-duplicate) a",thumbnail:!0})},reInitSlider(t){t&&t.detail&&t.detail.id&&t.detail.id!=this.itemId||this.slider&&setTimeout(()=>{if(document.querySelector("#"+this.getAtomSwiperThumbsId())){try{this.slider.destroy(),this.sliderThumbs.destroy()}catch(t){console.error(t)}this.initSlider()}},300)},reload(t){t&&t.detail.id!=this.itemId||(this.inLoading=!0,setTimeout(()=>{document.location.reload()},1e3))},reUploadProduct(t){t&&t.detail.id!=this.itemId||this.uploadProductInfo(this.getProductId,this.getOfferSortn).then(()=>{this.$forceUpdate(),this.reInitSlider()})},changeLeftPanel(t){if(t&&t.detail.id!=this.itemId)return;let e=12-this.getAttrValue("left_column"),o=this.getData();o.attrs.right_column.value=e,this.setAtomData(o)},getProductPhotos(t="medium"){return this.product&&this.product.photos?this.product.photos[t]:[]}}},c=o(100),u=o(367),h=o(99),p={name:"ProductButton",mixins:[i.a,h.a,c.a,u.a,n,l],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>o.e(21).then(o.bind(null,421)),WidthResize:()=>o.e(74).then(o.bind(null,422))}},g=o(98),m=Object(g.a)(p,s,[],!1,null,null,null);m.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/product/product.vue";e.default=m.exports}}]);