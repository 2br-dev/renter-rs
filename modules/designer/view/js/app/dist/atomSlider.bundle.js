(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{366:function(t,e,s){"use strict";var i=s(7),o=s(156);s(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(s){console.info("name",t),console.info("attr",e),console.error(s)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(s=>{t[s]&&e.push("d-hidden-"+s)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}o.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,s=t.tag,i=this.getStyle,o=[],r=[];Object.keys(i).forEach(t=>{"padding-top"==t||"padding-bottom"==t?r.push(t+":"+i[t]):o.push(t+":"+i[t])});let a=this.getClass;return`<div style="${r.join(";")}"><${s} id="${this.getAtomTagId()}" class="${a} ${this.getAtomIdByBlockId()}" style="${o.join(";")}">${e}</${s}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let s=this.getData();s.css[t].value=e,this.setAtomData(s)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(i.b)(["closeLastPanel"]),...Object(i.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,s=t.tag;return`<${s} class="${this.getAtomIdByBlockId()}">${e}</${s}>`},contentWithoutClass(){let t=this.getData(),e=t.html,s=t.tag,i="";return this.getSpecialStyles&&(i="style='"+this.getSpecialStyles()+"'"),`<${s} ${i}>${e}</${s}>`},...Object(i.c)("blocks",["getAtomData"]),...Object(i.c)(["getMenuStack"])}}},367:function(t,e,s){"use strict";e.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(t){let e=t.split("/").pop().replace(".","_");if(!window[e+"_loaded"]){let s=document.createElement("script");s.type="text/javascript",s.src=t,document.body.appendChild(s),window[e+"_loaded"]=1}},loadExternalCSS(t){let e=t.split("/").pop().replace(".","_");window[e+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${t}" type="text/css" rel="stylesheet"/>\n               `))}}}},395:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.getHiddenClasses()},[s("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),s("div",{ref:"thisAtom",staticClass:"d-atom",attrs:{id:t.getAtomIdByBlockId()},on:{click:function(e){return e.preventDefault(),t.openAtomSliderParams(e)}}},[s("div",{staticClass:"d-atom-instance no-hover d-atom-slider"},[t.inLoading?[s("div",{staticClass:"d-atom-form"},[s("div",{staticClass:"d-in-loading"},[t._v(t._s(t.lang("Подождите...")))])])]:[t.getZone?s("div",{staticClass:"d-atom-item",class:t.getAtomClass()},[s("WidthResize",{attrs:{"block-id":t.blockId,"item-id":t.itemId},on:{resizeBlock:function(e){return t.resizeBlock()}}}),t._v(" "),s("div",{staticClass:"d-slider-wrapper"},[s("div",{staticClass:"swiper-container",attrs:{id:t.getAtomSwiperId()}},[s("div",{staticClass:"swiper-wrapper"},[t.zone.images?t._l(t.zone.images,(function(t,e){return s("div",{key:e,staticClass:"swiper-slide"},[t.link.length?[s("a",{staticClass:" d-slider-photo-wrapper",attrs:{href:t.link,target:t.blank?"_blank":"_self"}},[s("img",{staticClass:"d-slider-photo",attrs:{src:t.image,alt:t.title}})])]:[s("div",{staticClass:" d-slider-photo-wrapper"},[s("img",{staticClass:"d-slider-photo",attrs:{src:t.image,alt:t.title}})])]],2)})):t._e()],2),t._v(" "),t.isShowPagination()?s("div",{staticClass:"swiper-pagination",attrs:{id:t.getAtomSwiperPaginationId()}}):t._e(),t._v(" "),t.isShowArrows()?[s("div",{staticClass:"swiper-button-next d-swiper-arrow",attrs:{id:t.getAtomSwiperButtonId("next")}}),t._v(" "),s("div",{staticClass:"swiper-button-prev d-swiper-arrow",attrs:{id:t.getAtomSwiperButtonId("prev")}})]:t._e()],2),t._v(" "),t.getAttrValue("show_thumbs")&&t.zone.images&&t.zone.images.length>1?s("div",{staticClass:"d-slider-swiper-thumbs-wrapper"},[s("div",{staticClass:"swiper-container swiper-wrapper-thumbs",attrs:{id:t.getAtomSwiperThumbsId()}},[s("div",{staticClass:"swiper-wrapper"},t._l(t.zone.thumbs,(function(t,e){return s("div",{key:e,staticClass:"swiper-slide"},[s("a",[s("img",{attrs:{src:t,alt:""}})])])})),0),t._v(" "),t.getAttrValue("show_thumb_arrows")?[s("div",{staticClass:"swiper-button-next d-swiper-arrow",attrs:{id:t.getAtomSwiperThumbsButtonId("next")}}),t._v(" "),s("div",{staticClass:"swiper-button-prev d-swiper-arrow",attrs:{id:t.getAtomSwiperThumbsButtonId("prev")}})]:t._e()],2)]):t._e()])],1):s("div",{staticClass:"d-atom-no-product d-atom-none-select-instance"},[s("div",{staticClass:"d-atom-none-select"},[s("div",{staticClass:"d-atom-none-select-select-wrapper"},[s("p",[t._v(t._s(t.lang("Выберите зону для банеров:")))]),t._v(" "),s("select",{ref:"selectZone",staticClass:"d-atom-none-select-form-select",on:{change:function(e){return e.preventDefault(),e.stopPropagation(),t.onZoneSelect(e)}}},[t._l(t.zonesList(),(function(e,i){return[s("option",{domProps:{value:i}},[t._v(t._s(e))])]}))],2)]),t._v(" "),t.isNeedShowSelectButton?s("a",{staticClass:"d-green-button",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.onSelectAlbum(e)}}},[t._v(t._s(t.lang("Выбрать")))]):t._e(),t._v(" "),s("a",{staticClass:"d-gray-button",attrs:{href:t.addBannerZone(),target:"_blank"},on:{click:function(t){t.stopPropagation()}}},[t._v(t._s(t.lang("Добавить")))])])])]],2)])],1)};i._withStripped=!0;var o=s(366),r=s(30);class a extends r.a{getBannerZonesList(){return this.makeGETRequest(window.global.designer.banners.zonesList)}getZoneData(t,e,s){let i={zone:t,thumb_width:e,thumb_height:s},o=this.createUrlWithParams(window.global.designer.banners.getZoneByIdUrl,i);return this.makeGETRequest(o)}}const n=new a;var d={data:()=>({slider:{},offers:{},zone:{images:[]},inLoading:!1,isNeedShowSelectButton:!1,sliderThumbs:null,swiper:null,load_js:[window.global.designer.swiper_js_url],load_css:[window.global.designer.swiper_css_url],resizeTimeout:null}),mounted(){this.onMount(),this.setRedrawAtomListener(this.onMount),document.addEventListener("designer.slider-reinit",this.reInitSlider),document.addEventListener("designer.change-column-width",this.resizeBlock),document.addEventListener("designer.change-row-width",this.resizeBlock),window.addEventListener("resize",this.resizeBlock)},beforeDestroy(){this.removeRedrawAtomListener(this.onMount),document.removeEventListener("designer.slider-reinit",this.reInitSlider),document.removeEventListener("designer.change-column-width",this.resizeBlock),document.removeEventListener("designer.change-row-width",this.resizeBlock),window.removeEventListener("resize",this.resizeBlock)},methods:{resizeBlock(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{clearTimeout(this.resizeTimeout),this.reInitSlider()},100)},onMount(){this.inLoading=!0,this.getZone?(this.inLoading=!0,this.uploadAlbumInfo(this.getZone)):this.inLoading=!1},getAtomIdButtonByBlockId(){return"d-button-atom-"+this.blockId+"-"+this.itemId},onZoneSelect(t){this.isNeedShowSelectButton=t.target.value>0},zonesList:()=>window.global.designer.banners.zonesList,addBannerZone:()=>window.global.designer.banners.zoneAddUrl,onSelectAlbum(){let t=this.getData();t.zone=this.$refs.selectZone.value,this.uploadAlbumInfo(t.zone),this.setAtomData(t)},uploadAlbumInfo(){n.getZoneData(this.getZone,this.getAttrValue("thumb_width"),this.getAttrValue("thumb_height")).then(this.albumUploaded)},albumUploaded(t){this.zone=t.zone,this.body.removeEventListener("keyup",this.checkDeleteAtom),this.inLoading=!1,this.initSlider()},openAtomSliderParams(t){t.target.classList.contains("d-swiper-arrow")||(this.body.removeEventListener("keyup",this.checkDeleteAtom),this.getZone?this.openAtomParams():(this.setOpenHover(),this.body.addEventListener("keyup",this.checkDeleteAtom)))},getAtomSwiperId(){return"d-slider-swiper-"+this.blockId+"-"+this.itemId},getAtomSwiperPaginationId(){return"d-slider-swiper-pagination-"+this.blockId+"-"+this.itemId},getAtomSwiperButtonId(t){return"d-slider-swiper-"+t+"-"+this.blockId+"-"+this.itemId},initSlider(){let t={lazy:!0,autoHeight:!0,effect:this.getAttrValue("photo_effect"),grabCursor:!0,slidesPerView:this.getAttrValue("items_count"),freeMode:!0};this.getAttrValue("show_loop")&&(t.loop=!0),this.zone.images.length>1&&this.getAttrValue("show_arrows")&&(t.navigation={nextEl:"#"+this.getAtomSwiperButtonId("next"),prevEl:"#"+this.getAtomSwiperButtonId("prev")}),this.zone.images.length>1&&this.getAttrValue("show_pagination")&&(t.pagination={el:"#"+this.getAtomSwiperPaginationId(),clickable:!0}),this.getAttrValue("autoplay_speed")&&(t.autoplay={delay:this.getAttrValue("autoplay_speed"),disableOnInteraction:!1});let e,s=!1;if(this.getAttrValue("show_thumbs")&&this.zone.images.length>1){let e=this.getAttrValue("thumb_count");if(window.screen.width<=767){let t=this.getAttrValue("thumb_width"),s=window.screen.width;e=Math.floor((s-40)/parseInt(t,10))}s={grabCursor:!0,autoHeight:!0,slidesPerView:e,loopedSlides:e,freeMode:!0,watchSlidesVisibility:!0,watchSlidesProgress:!0},this.getAttrValue("show_thumb_arrows")&&(s.navigation={nextEl:"#"+this.getAtomSwiperThumbsButtonId("next"),prevEl:"#"+this.getAtomSwiperThumbsButtonId("prev")}),t.loopedSlides=e}e="undefined"==typeof Swiper?setInterval(()=>{"undefined"!=typeof Swiper&&(clearInterval(e),this.setSlider(t,s))},100):setTimeout(()=>{clearTimeout(e),this.setSlider(t,s)},500)},setSlider(t,e){e&&(this.sliderThumbs=new Swiper("#"+this.getAtomSwiperThumbsId(),e),t.thumbs={swiper:this.sliderThumbs});let s="#"+this.getAtomSwiperId();this.slider=new Swiper(s,t)},reInitSlider(t){t&&t.detail.id!=this.itemId||this.slider&&setTimeout(()=>{if(document.querySelector("#"+this.getAtomSwiperId())){try{this.slider.destroy()}catch(t){console.error(t)}this.initSlider()}},300)},isShowPagination(){return this.zone.images&&this.zone.images.length>1&&this.getAttrValue("show_pagination")},isShowArrows(){return this.zone.images&&this.zone.images.length>1&&this.getAttrValue("show_arrows")},getAtomSwiperThumbsId(){return"d-swiper-thumbs-"+this.blockId+"-"+this.itemId},getAtomSwiperThumbsButtonId(t){return"d-swiper-thumbs-"+t+"-"+this.blockId+"-"+this.itemId}},computed:{getZone(){return null!==this.getData().zone&&parseInt(this.getData().zone)}}},l=s(100),h=s(367),c=s(99),m={name:"AtomSlider",mixins:[o.a,c.a,l.a,h.a,d],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>s.e(21).then(s.bind(null,421)),WidthResize:()=>s.e(74).then(s.bind(null,422))}},u=s(98),g=Object(u.a)(m,i,[],!1,null,null,null);g.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/slider/slider.vue";e.default=g.exports}}]);