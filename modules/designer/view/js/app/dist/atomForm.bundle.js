(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{366:function(t,e,s){"use strict";var o=s(7),a=s(156);s(1);e.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(t){let e=this.getAttrs()[t];try{return e||console.error(lang.t(`Не найден аттрибут "${t}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),e.value}catch(s){console.info("name",t),console.info("attr",e),console.error(s)}},getCSSValue(t){return this.getData().css[t].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let t=this.getAdditionalClass();return this.getAtomIdByBlockId()+(t?" "+t:"")},getHiddenClasses(){let t=this.getData().hidden,e=[];return Object.keys(t).forEach(s=>{t[s]&&e.push("d-hidden-"+s)}),e},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let t=setTimeout(()=>{if(clearTimeout(t),sessionStorage.getItem("atom-dbl-click"))return;let e=this.getMenuStack;if(e.length){let t=e[e.length-1];if("atom"==t.data.type&&t.data.blockId==this.blockId&&t.data.id==this.itemId)return}a.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(t=>{t.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let t=this.getData(),e=t.html,s=t.tag,o=this.getStyle,a=[],r=[];Object.keys(o).forEach(t=>{"padding-top"==t||"padding-bottom"==t?r.push(t+":"+o[t]):a.push(t+":"+o[t])});let i=this.getClass;return`<div style="${r.join(";")}"><${s} id="${this.getAtomTagId()}" class="${i} ${this.getAtomIdByBlockId()}" style="${a.join(";")}">${e}</${s}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(t,e){let s=this.getData();s.css[t].value=e,this.setAtomData(s)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let t=this.body.querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let t=document.querySelector("body").querySelectorAll(".module-wrapper");t&&t.forEach(t=>{t.classList.remove("disabled")})},setColumnDraggable(t){let e=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:t}});document.dispatchEvent(e)},setRedrawAtomListener(t){document.addEventListener("designer.redraw-atom."+this.itemId,t)},removeRedrawAtomListener(t){document.removeEventListener("designer.redraw-atom."+this.itemId,t)},...Object(o.b)(["closeLastPanel"]),...Object(o.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let t=this.getData(),e=t.html,s=t.tag;return`<${s} class="${this.getAtomIdByBlockId()}">${e}</${s}>`},contentWithoutClass(){let t=this.getData(),e=t.html,s=t.tag,o="";return this.getSpecialStyles&&(o="style='"+this.getSpecialStyles()+"'"),`<${s} ${o}>${e}</${s}>`},...Object(o.c)("blocks",["getAtomData"]),...Object(o.c)(["getMenuStack"])}}},390:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.getHiddenClasses()},[s("AtomMarginZone",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),s("div",{ref:"thisAtom",staticClass:"d-atom",attrs:{id:t.getAtomIdByBlockId()}},[t.inLoading?[s("div",{staticClass:"d-atom-form"},[s("div",{staticClass:"d-in-loading"},[t._v(t._s(t.lang("Подождите...")))])])]:[t.getFormId?s("div",{staticClass:"d-atom-instance no-hover d-atom-form",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.openAtomFormParams(e)}}},[s("form",{staticClass:"d-atom-item",class:t.getAtomClass()},[s("WidthResize",{attrs:{"block-id":t.blockId,"item-id":t.itemId}}),t._v(" "),s("div",{staticClass:"d-atom-form-fields"},[t.isNeedShowSuccess()?s("div",{staticClass:"d-form-success"},[t._v("\n                            "+t._s(t.getSuccessMessage())+"\n                        ")]):[t.getAttrValue("show_header")?s("div",{staticClass:"d-form-header"},[t._v("\n                                "+t._s(t.formData.title)+"\n                            ")]):t._e(),t._v(" "),t.isNeedShowError()?s("div",{staticClass:"d-form-errors"},[s("div",{staticClass:"d-form-error"},[t._v("\n                                    "+t._s(t.lang("Сообщение об ошибке в форме"))+"\n                                ")])]):t._e(),t._v(" "),s("div",{staticClass:"d-atom-form-fields-wrapper"},[t._l(t.formData.list,(function(e,o){return s("div",{staticClass:"d-atom-form-title-field-wrapper"},["yesno"!=e.show_type&&t.getAttrValue("show_field_header")?s("div",{staticClass:"d-atom-form-field-title d-form-title"},[t._v("\n                                        "+t._s(e.title)),t.isRequiredField(e)?s("sup",{staticClass:"d-atom-form-required"},[t._v("*")]):t._e()]):t._e(),t._v(" "),s("div",{staticClass:"d-atom-form-field"},["string"==e.show_type?[s("input",{staticClass:"d-form-input",attrs:{type:"text",placeholder:t.getPlaceholder(e)},on:t._d({},[t.$clickevent,function(e){return e.preventDefault(),t.resetFocus(e)}])})]:"email"==e.show_type?[s("input",{staticClass:"d-form-input",attrs:{type:"email",placeholder:t.getPlaceholder(e)},on:t._d({},[t.$clickevent,function(e){return e.preventDefault(),t.resetFocus(e)}])})]:"file"==e.show_type?[s("input",{staticClass:"d-form-input-file",attrs:{type:"file"}})]:"text"==e.show_type?[s("textarea",{staticClass:"d-form-textarea",attrs:{placeholder:t.getPlaceholder(e)},on:t._d({},[t.$clickevent,function(e){return e.preventDefault(),t.resetFocus(e)}])})]:"yesno"==e.show_type?[s("input",{attrs:{id:t.getFieldId(t.formData.id,e.id),type:"checkbox"}}),t._v(" "),s("label",{staticClass:"d-form-label",attrs:{for:t.getFieldId(t.formData.id,e.id)}},[t._v(t._s(e.title))])]:"list"==e.show_type?["checkbox"==e.show_list_as?t._l(t.getListOptions(e),(function(o,a){return s("div",{key:a},[s("input",{attrs:{id:t.getFieldIdForList(t.formData.id,e.id,a),type:"checkbox"},domProps:{checked:0==a,value:o},on:t._d({},[t.$clickevent,function(e){return e.preventDefault(),t.resetFocus(e)}])}),t._v(" "),s("label",{staticClass:"d-form-label",attrs:{for:t.getFieldIdForList(t.formData.id,e.id,a)}},[t._v(t._s(o))])])})):t._e(),t._v(" "),"radio"==e.show_list_as?t._l(t.getListOptions(e),(function(o,a){return s("div",{key:a},[s("input",{attrs:{id:t.getFieldIdForList(t.formData.id,e.id,a),type:"radio"},domProps:{checked:0==a,value:o},on:t._d({},[t.$clickevent,function(e){return e.preventDefault(),t.resetFocus(e)}])}),t._v(" "),s("label",{staticClass:"d-form-label",attrs:{for:t.getFieldIdForList(t.formData.id,e.id,a)}},[t._v(t._s(o))])])})):t._e(),t._v(" "),"select"==e.show_list_as?[s("select",{staticClass:"d-form-input",on:t._d({},[t.$clickevent,function(e){return e.preventDefault(),t.resetFocus(e)}])},[t._l(t.getListOptions(e),(function(e,o){return[s("option",{domProps:{value:e}},[t._v(t._s(e))])]}))],2)]:t._e()]:t._e(),t._v(" "),t.isNeedShowHint(e)?s("div",{staticClass:"d-form-hint"},[t._v("\n                                            "+t._s(e.hint)+"\n                                        ")]):t._e()],2)])})),t._v(" "),t.isNeedAgree("in")?s("div",{staticClass:"d-atom-form-field"},[t.getAttrValue("show_agree_checkbox")?s("input",{attrs:{type:"checkbox",name:"agreement",id:"d-agree-fz-152",value:"1",required:""}}):t._e(),t._v(" "),s("label",{staticClass:"d-form-label",attrs:{for:"d-agree-fz-152"},domProps:{innerHTML:t._s(t.getAgreementText())}})]):t._e(),t._v(" "),s("div",{staticClass:"d-atom-form-send-button-wrapper"},[s("div",{staticClass:"d-atom-instance no-hover",style:t.getWrapperStylesForButton()},[s("button",{staticClass:"d-form-button"},[t._v(t._s(t.lang("Отправить")))])])])],2),t._v(" "),t.isNeedAgree("out")?s("div",{staticClass:"d-atom-form-field"},[t.getAttrValue("show_agree_checkbox")?s("input",{attrs:{type:"checkbox",name:"agreement",id:t.getAgreeForAttr(),value:"1",required:""}}):t._e(),t._v(" "),s("label",{staticClass:"d-form-label",attrs:{for:t.getAgreeForAttr()},domProps:{innerHTML:t._s(t.getAgreementText())}})]):t._e()]],2)],1)]):s("div",{staticClass:"d-atom-instance d-atom-form",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.openAtomFormParams(e)}}},[s("div",{staticClass:"d-atom-none-select"},[s("div",{staticClass:"d-atom-none-select-select-wrapper"},[s("p",[t._v(t._s(t.lang("Выберите форму:")))]),t._v(" "),s("select",{ref:"selectForm",staticClass:"d-atom-none-select-form-select",on:{change:function(e){return e.preventDefault(),e.stopPropagation(),t.onFormSelect(e)}}},[t._l(t.formsList(),(function(e,o){return[s("option",{domProps:{value:o}},[t._v(t._s(e))])]}))],2)]),t._v(" "),t.isNeedShowSelectButton?s("a",{staticClass:"d-green-button",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.selectForm(e)}}},[t._v(t._s(t.lang("Выбрать")))]):t._e(),t._v(" "),s("a",{staticClass:"d-gray-button",attrs:{href:t.addFormHref(),target:"_blank"},on:{click:function(t){t.stopPropagation()}}},[t._v(t._s(t.lang("Добавить")))])])])]],2)],1)};o._withStripped=!0;var a=s(366),r=s(30);class i extends r.a{getFormsList(){return this.makeGETRequest(window.global.designer.form.getFormsListUrl)}getFormData(t){let e=this.createUrlWithParams(window.global.designer.form.getFormByIdUrl,{form_id:t});return this.makeGETRequest(e)}}var l=s(7);const n=new i;var d={data:()=>({inLoading:!0,isNeedShowSelectButton:!1}),mounted(){this.onMount(),this.setRedrawAtomListener(this.onMount)},beforeUpdate(){setTimeout(()=>{this.$refs.selectForm&&this.$refs.selectForm.dispatchEvent(new Event("change"))},300)},beforeDestroy(){this.body.removeEventListener("keyup",this.checkDeleteAtom),this.removeRedrawAtomListener(this.onMount)},methods:{onMount(){this.inLoading=!0,this.form_id=this.getFormId,this.getFormId?(this.inLoading=!0,n.getFormData(this.getFormId).then(this.formUploaded)):this.inLoading=!1},addFormHref:()=>window.global.designer.form.formAddUrl,formsList:()=>window.global.designer.form.formsList,openAtomFormParams(){this.body.removeEventListener("keyup",this.checkDeleteAtom),this.getFormId?this.openAtomParams():(this.setOpenHover(),this.body.addEventListener("keyup",this.checkDeleteAtom))},onFormSelect(t){this.isNeedShowSelectButton=t.target.value>0},selectForm(){let t=this.getData();t.form_id=this.$refs.selectForm.value,this.inLoading=!0,this.setAtomData(t),setTimeout(()=>{n.getFormData(t.form_id).then(this.formUploaded)},200)},formUploaded(t){let e=this.getData(),s=t.form;s.list&&s.list.forEach((t,e)=>{t.attributes_list&&t.attributes_list.key&&(s.list[e].attrs={},t.attributes_list.key.forEach((o,a)=>{s.list[e].attrs[o]=t.attributes_list.val[a]}))}),e.formData=s,this.setAtomData(e),this.body.removeEventListener("keyup",this.checkDeleteAtom),this.inLoading=!1},getWrapperStylesForButton(){let t=this.getAtomChildren(),e={};return t.button.css["padding-top"]&&(e["padding-top"]=t.button.css["padding-top"].value),e},getSuccessMessage(){let t=this.formData.successMessage;return t&&t.length?t:lang.t("Благодарим Вас за обращение к нам. Мы ответим вам при первой же возможности.")},isRequiredField:t=>t.required>0,isNeedShowSuccess(){return this.getAttrValue("success")},isNeedShowError(){return this.getAttrValue("error")},getFieldWrapperStyles(t){let e,s=this.getData().childs,o={"margin-bottom":""};switch(t.show_type){case"string":case"text":case"file":e=s[t.show_type];break;case"email":e=s.string;break;case"yesno":e=s.label;break;case"list":switch(t.show_list_as){case"checkbox":case"radio":e=s.label;break;case"select":e=s.string}}return e.css["margin-bottom"]&&(o["margin-bottom"]=e.css["margin-bottom"].value),o},isNeedShowHint(t){return t.hint&&t.hint.length&&-1!=["string","text","email"].indexOf(t.show_type)&&this.getAttrValue("show_hint")},resetFocus(t){t.target.blur()},getListOptions:t=>t.anwer_list.split("\n"),getPlaceholder:t=>t.attrs&&t.attrs.placeholder?t.attrs.placeholder:t.title,getFieldIdForList(t,e,s){return this.getFieldId(t,e)+`-${s}`},isNeedAgree(t){return window.global.designer.form.formAgreement&&this.getAttrValue("agreement_show_type")==t},policyAgreementLink:()=>window.global.designer.form.formAgreementLink,getFieldId:(t,e)=>`d-form-${t}-field-${e}`,getAgreementText(){let t="";return this.getAttrValue("show_agree_checkbox")?t+=lang.t("Я даю согласие на "):t+=lang.t('Нажимая кнопку "Отправить" я подтверждаю согласие на '),t+='<a :href="'+this.policyAgreementLink()+'" target="_blank">'+lang.t("обработку персональных данных")+"</a>",t},getAgreeForAttr(){return"d-agree-fz-152-"+this.itemId},...Object(l.b)("blocks",["setAtomDataWithOutSaveQuery"])},computed:{formData(){let t=this.getData().formData;return t||[]},getFormId(){return parseInt(this.getData().form_id)}}},c=s(100),m=s(99),u={name:"AtomForm",mixins:[a.a,m.a,c.a,d],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>s.e(21).then(s.bind(null,421)),WidthResize:()=>s.e(74).then(s.bind(null,422))}},h=s(98),g=Object(h.a)(u,o,[],!1,null,null,null);g.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/form/form.vue";e.default=g.exports}}]);