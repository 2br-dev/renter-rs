(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{365:function(e,t,s){"use strict";var i=s(7),a=s(1);t.a={data:()=>({tinymceOptions:{height:200,theme:"modern",plugins:["link image lists anchor","searchreplace wordcount visualblocks visualchars code fullscreen media","save table contextmenu paste textcolor"],menubar:"file edit view",toolbar:"insertfile undo redo | styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons",language:"ru"},tinymceInlineOptions:{toolbar_items_size:"small",language:"ru",menubar:!1,inline:!0,plugins:"link textcolor",toolbar:"bold italic underline strikethrough",valid_elements:"*",valid_styles:{"*":"font-size,font-family,color,text-decoration,text-align"},extended_valid_elements:"*[*]",cleanup:!1,verify_html:!1,powerpaste_word_import:"clean",powerpaste_html_import:"clean",content_css:[]}}),methods:{getItemValue(e,t,s=null){let i=this.getItem();if(s){if(i.childs[s][e]&&i.childs[s][e][t])return i.childs[s][e][t].value;console.error(lang.t(`No property "${t}" in SUB CHILD item[${e}]`),i.childs[s][e])}else{if(i[e]&&i[e][t])return i[e][t].value;console.error(lang.t(`No property "${t}" in item[${e}]`),i[e])}return""},getItem(){switch(this.itemType){case a.a.atom:return this.getAtomData(this.blockId,this.itemId);case a.a.column:return this.getColumnData(this.blockId,this.itemId);case a.a.row:return this.getRowData(this.blockId,this.itemId);default:throw new Error(lang.t("Нет метода для получения данных. Тип: %0",[this.itemType]))}},getItemOptions(){return this.getItem()[this.keyName][this.item.name].data.options},setItemData(e){switch(this.itemType){case a.a.atom:this.setAtomData(e);break;case a.a.column:this.setColumnData(e);break;case a.a.row:this.setRowData(e);break;default:throw new Error(lang.t("Нет метода для получения данных. Тип: %0",[this.itemType]))}},setAtomKeyValue(e){let t=this.getItem();t[this.item.name]=e,this.setItemData(t);let s=new CustomEvent("designer.redraw-atom."+t.id,{detail:{id:t.id,value:e}});document.dispatchEvent(s),setTimeout(()=>{this.checkIfNeedSendEventAfterEdit(t)},500)},addStyleIfNeeded(e,t){"css"==this.keyName&&("background-image"==e&&t.trim().length&&(t="url('"+t+"')"),this.addStyleParameter(e,t))},checkIfNeedSendEventAfterEdit(e){if(e[this.keyName][this.item.name].debug_event){let t=new CustomEvent(e[this.keyName][this.item.name].debug_event,{detail:{id:this.itemId}});document.dispatchEvent(t)}},sendDataValueFromEvent(e){let t=e.target.value;"background-image"==this.item.name&&(t=t.replaceAll(" ","%20"));let s=this.getItem();"css"==this.keyName&&this.itemChildId?s.childs[this.itemChildId][this.keyName][this.item.name].value=t:(s[this.keyName][this.item.name].value=t,this.checkIfNeedSendEventAfterEdit(s)),this.setItemData(s)},sendDataValue(e){let t=this.getItem();"background-image"==this.item.name&&(e=e.replaceAll(" ","%20")),"css"==this.keyName&&this.itemChildId?t.childs[this.itemChildId][this.keyName][this.item.name].value=e:(t[this.keyName][this.item.name].value=e,this.checkIfNeedSendEventAfterEdit(t)),this.setItemData(t)},clear(){this.sendDataValue(""),this.isHoverable&&this.sendDataHoverValue("")},getStyleLikeObject(){let e=this.getItem();return a.b.convertInlineStyleToObject(e.attrs.style.value)},addStyleParameter(e,t){let s=this.getStyleLikeObject();"string"==typeof t?0==(t=t.trim()).length?delete s[e]:s[e]=t:"object"==typeof t&&(s[e]=t);let i=this.getItem();i.attrs.style.value=a.b.convertStyleObjectToString(s),this.setItemData(i)},...Object(i.b)("blocks",["setAtomData","setRowData","setColumnData"])},computed:{itemValue(){return this.getItemValue(this.keyName,this.item.name,this.itemChildId)},itemHoverValue(){return this.getItemHoverValue(this.keyName,this.item.name,this.itemChildId)},...Object(i.c)("blocks",["getAtomData","getColumnData","getRowData"])}}},439:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"d-menu-map-points"},[e._l(e.itemValue,(function(t,i){return s("div",{key:i,staticClass:"d-point-container"},[s("button",{staticClass:"d-remove-point",on:{click:function(t){return t.preventDefault(),e.deletePoint(i)}}},[e._v("x")]),e._v(" "),s("a",{staticClass:"d-point-edit-title",on:{click:function(t){return t.preventDefault(),e.toggleEditPoint(i)}}},[e._v(e._s(e.getAddressTitle(t)))]),e._v(" "),s("div",{staticClass:"d-point-details",class:{"d-open":e.editISOpened(i)}},[s("div",{staticClass:"d-point-title"},[e._v(e._s(e.lang("Название"))+":")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"address.title"}],attrs:{type:"text",placeholder:t.title},domProps:{value:t.title},on:{input:function(s){s.target.composing||e.$set(t,"title",s.target.value)}}}),e._v(" "),s("div",{staticClass:"d-point-title"},[e._v(e._s(e.lang("Адрес"))+":")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.address,expression:"address.address"}],attrs:{type:"text",placeholder:t.address},domProps:{value:t.address},on:{input:function(s){s.target.composing||e.$set(t,"address",s.target.value)}}}),e._v(" "),s("div",{staticClass:"d-point-title"},[e._v(e._s(e.lang("Широта"))+":")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.lat,expression:"address.lat"}],attrs:{type:"number",placeholder:t.lat},domProps:{value:t.lat},on:{input:function(s){s.target.composing||e.$set(t,"lat",s.target.value)}}}),e._v(" "),s("div",{staticClass:"d-point-title"},[e._v(e._s(e.lang("Долгота"))+":")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.long,expression:"address.long"}],attrs:{type:"number",placeholder:t.long},domProps:{value:t.long},on:{input:function(s){s.target.composing||e.$set(t,"long",s.target.value)}}}),e._v(" "),s("div",{staticClass:"d-point-title"},[e._v(e._s(e.lang("Описание"))+":")]),e._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.balloon,expression:"address.balloon"}],attrs:{placeholder:t.balloon},domProps:{value:t.balloon},on:{input:function(s){s.target.composing||e.$set(t,"balloon",s.target.value)}}}),e._v(" "),s("button",{staticClass:"d-green-button",on:{click:function(t){return t.preventDefault(),e.editPoint(i)}}},[e._v(e._s(e.lang("Сохранить")))])])])})),e._v(" "),s("div",{staticClass:"d-point-container"},[s("input",{ref:"address",staticClass:"d-point-address",attrs:{type:"text",placeholder:e.lang("Введите адрес")},on:{input:function(t){return t.preventDefault(),e.initMap()}}}),e._v(" "),e.showAddressList?s("div",{staticClass:"d-address-list"},[s("ul",e._l(e.addressesList,(function(t,i){return s("li",{key:i},[s("a",{on:{click:function(s){return s.preventDefault(),e.getPointCoordinates(t.displayName)}}},[e._v(e._s(t.displayName))])])})),0)]):e._e(),e._v(" "),s("div",{staticClass:"d-point-coords"},[s("input",{ref:"long",staticClass:"d-coord-point",attrs:{type:"number",placeholder:e.lang("Широта")}}),e._v(" "),s("input",{ref:"lat",staticClass:"d-coord-point",attrs:{type:"number",placeholder:e.lang("Долгота")}})]),e._v(" "),e.addressesList.length?s("div",{staticClass:"d-coord-point-info"},[s("input",{ref:"title",staticClass:"d-info",attrs:{type:"text",placeholder:e.lang("Укажите заголовок")}}),e._v(" "),s("textarea",{ref:"balloon",attrs:{placeholder:e.lang("Укажите описание")}})]):e._e()]),e._v(" "),s("button",{staticClass:"d-gray-button",on:{click:function(t){return t.preventDefault(),e.setValue(t)}}},[e._v(e._s(e.lang("Добавить метку")))])],2)};i._withStripped=!0;var a=s(365),l=s(51),n={data:()=>({showAddressList:!1,addressesList:[],opened:[]}),methods:{deletePoint(e){this.itemValue.splice(e,1),this.sendDataValue(this.itemValue)},toggleEditPoint(e){let t=this.opened.indexOf(e);-1!=t?this.opened.splice(t,1):this.opened.push(e)},editISOpened(e){return-1!=this.opened.indexOf(e)},editPoint(e){this.itemValue[e].long.length?this.itemValue[e].lat.length?(this.toggleEditPoint(e),this.sendDataValue(this.itemValue)):l.a.showError(lang.t("Не указана широта")):l.a.showError(lang.t("Не указана долгота"))},setValue(){let e=this.itemValue;this.$refs.long.value.length?this.$refs.lat.value.length?(e.push({address:this.$refs.address.value,long:this.$refs.long.value,lat:this.$refs.lat.value,title:this.$refs.title.value,balloon:this.$refs.balloon.value}),this.sendDataValue(e),this.addressesList=[],this.$refs.address.value="",this.$refs.long.value="",this.$refs.lat.value="",this.$refs.title.value="",this.$refs.balloon.value=""):l.a.showError(lang.t("Не указана широта")):l.a.showError(lang.t("Не указана долгота"))},initMap(){let e=setInterval(()=>{ymaps&&(clearInterval(e),ymaps.ready(()=>{ymaps.suggest(this.$refs.address.value).then(e=>{this.addressesList=e}),this.showAddressList=!0}))},100)},getAddressTitle:e=>e.title.length?e.title:lang.t("Не указано"),getPointCoordinates(e){this.$refs.address.value=e,ymaps.geocode(e,{results:1}).then(e=>{let t=e.geoObjects.get(0).geometry.getCoordinates();this.$refs.lat.value=t[0],this.$refs.long.value=t[1],this.showAddressList=!1})}}},r={name:"ControlMapPoints",mixins:[a.a,n],props:{keyName:{type:String,required:!0},blockId:{type:[String,Number],required:!0},itemType:{type:String,required:!0},itemId:{type:String,required:!0},item:{type:Object,required:!0},itemChildId:{type:[String,Number]}}},o=s(98),d=Object(o.a)(r,i,[],!1,null,null,null);d.options.__file="-readyscript/modules/designer/view/js/app/src/components/leftpanel/controls/mappoints/mappoints.vue";t.default=d.exports}}]);