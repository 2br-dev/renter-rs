(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{366:function(e,t,s){"use strict";var i=s(7),a=s(156);s(1);t.a={data:()=>({body:null}),mounted(){this.body=document.querySelector("body")},methods:{getData(){return this.getAtomData(this.blockId,this.itemId)},getAttrs(){return this.getData().attrs},getAttrValue(e){let t=this.getAttrs()[e];try{return t||console.error(lang.t(`Не найден аттрибут "${e}" для атома c id ${this.itemId} в блоке ${this.blockId}`)),t.value}catch(s){console.info("name",e),console.info("attr",t),console.error(s)}},getCSSValue(e){return this.getData().css[e].value},getAdditionalClass(){return this.getData().additional_class},getAtomClass(){let e=this.getAdditionalClass();return this.getAtomIdByBlockId()+(e?" "+e:"")},getHiddenClasses(){let e=this.getData().hidden,t=[];return Object.keys(e).forEach(s=>{e[s]&&t.push("d-hidden-"+s)}),t},getAtomIdByBlockId(){return"d-atom-"+this.blockId+"-"+this.itemId},getAtomTagId(){return"d-atom-tag-"+this.itemId},getAtomChildren(){return this.getData().childs},openAtomParams(){let e=setTimeout(()=>{if(clearTimeout(e),sessionStorage.getItem("atom-dbl-click"))return;let t=this.getMenuStack;if(t.length){let e=t[t.length-1];if("atom"==e.data.type&&e.data.blockId==this.blockId&&e.data.id==this.itemId)return}a.designerLeftMenu.openMenuForAtom({blockId:this.blockId,id:this.itemId,type:"atom"})},250);setTimeout(()=>{this.setOpenHover()},50)},setOpenHover(){document.querySelectorAll(".d-atom.hover").forEach(e=>{e.classList.remove("hover")}),this.$refs.thisAtom.classList.add("hover")},contentForTiny(){let e=this.getData(),t=e.html,s=e.tag,i=this.getStyle,a=[],l=[];Object.keys(i).forEach(e=>{"padding-top"==e||"padding-bottom"==e?l.push(e+":"+i[e]):a.push(e+":"+i[e])});let o=this.getClass;return`<div style="${l.join(";")}"><${s} id="${this.getAtomTagId()}" class="${o} ${this.getAtomIdByBlockId()}" style="${a.join(";")}">${t}</${s}></div>`},removeFlagDoubleClick(){sessionStorage.removeItem("atom-dbl-click")},setFlagDoubleClick(){sessionStorage.setItem("atom-dbl-click",1)},setCSSParamValue(e,t){let s=this.getData();s.css[e].value=t,this.setAtomData(s)},addRowEditClass(){this.body.classList.add("d-row-edit")},removeRowEditClass(){this.body.classList.remove("d-row-edit")},disableEditModeModules(){let e=this.body.querySelectorAll(".module-wrapper");e&&e.forEach(e=>{e.classList.add("disabled")}),this.$el.closest(".module-wrapper").classList.remove("disabled")},enableEditModeModules(){let e=document.querySelector("body").querySelectorAll(".module-wrapper");e&&e.forEach(e=>{e.classList.remove("disabled")})},setColumnDraggable(e){let t=new CustomEvent("atom-image-set-column-draggable",{detail:{enabled:e}});document.dispatchEvent(t)},setRedrawAtomListener(e){document.addEventListener("designer.redraw-atom."+this.itemId,e)},removeRedrawAtomListener(e){document.removeEventListener("designer.redraw-atom."+this.itemId,e)},...Object(i.b)(["closeLastPanel"]),...Object(i.b)("blocks",["setAtomData"])},computed:{getHtml(){return this.getData().html},content(){let e=this.getData(),t=e.html,s=e.tag;return`<${s} class="${this.getAtomIdByBlockId()}">${t}</${s}>`},contentWithoutClass(){let e=this.getData(),t=e.html,s=e.tag,i="";return this.getSpecialStyles&&(i="style='"+this.getSpecialStyles()+"'"),`<${s} ${i}>${t}</${s}>`},...Object(i.c)("blocks",["getAtomData"]),...Object(i.c)(["getMenuStack"])}}},367:function(e,t,s){"use strict";t.a={mounted(){this.load_js&&this.load_js.forEach(this.loadExternalJS),this.load_css&&this.load_css.forEach(this.loadExternalCSS)},methods:{loadExternalJS(e){let t=e.split("/").pop().replace(".","_");if(!window[t+"_loaded"]){let s=document.createElement("script");s.type="text/javascript",s.src=e,document.body.appendChild(s),window[t+"_loaded"]=1}},loadExternalCSS(e){let t=e.split("/").pop().replace(".","_");window[t+"_loaded"]||(this.body||(this.body=document.querySelector("body")),this.body.insertAdjacentHTML("beforeend",`\n                   <link href="${e}" type="text/css" rel="stylesheet"/>\n               `))}}}},373:function(e,t,s){"use strict";t.a={data:()=>({currentSelectedCategory:"",categoriesLoaded:[],categoriesOpened:[],isCategoryListOpened:!1,categoryTree:[],isNeedShowSelectButton:!1}),methods:{onToggleCategorySelect(e){this.isCategoryListOpened=!this.isCategoryListOpened,this.isCategoryListOpened?this.addEditClass():(this.removeEditClass(),this.categoriesOpened=[])},isCategoryOpened(e){return-1!=this.categoriesOpened.indexOf(e)},insertCategoriesToTree(e={},t=[],s=0){if(s){let i=!1;e.forEach(e=>{e.id==s&&(e.childs=t,this.categoriesOpened.push(e.id),i=!0),!i&&e.childs&&this.insertCategoriesToTree(e.childs,t,s)})}else this.categoryTree=t},onCategorySelect(e){let t=e.target.closest(".d-tree-select_list-item");this.$refs.selectedCategory.dataset.id=t.dataset.id,this.currentSelectedCategory=t.dataset.title,this.isCategoryListOpened=!1,this.isNeedShowSelectButton=!0,this.removeEditClass(),e.preventDefault(),e.stopPropagation()},onCategoryClickEvents(e){e.target.classList.contains("d-tree-branch-toggle")?this.toggleCategory(e):this.onCategorySelect(e)},getCategoryItemsTree(e=null){let t=[];return null===e&&(e=this.categoryTree),Object.keys(e).forEach(s=>{let i=e[s],a="";i.childs&&(a=this.getCategoryItemsTree(i.childs));let l=i.childscount>0?"d-tree-branch":"d-tree-leaf";i.childscount>0&&this.isCategoryOpened(i.id)?l+=" d-tree-expanded":l+=" d-tree-collapsed",t.push(`\n                    <li class="d-tree-select_list-item ${l}" data-id="${i.id}" data-title="${i.title}">\n                        <div class="d-tree-select_list-item_row d-tree-row">\n                            <i class="d-tree-select_list-item_sublist-toggle zmdi d-tree-branch-toggle" data-id="${i.id}"></i>\n                            <span class="d-tree-select_list-item_title">${i.title}</span>\n                        </div>\n                        ${a.length?'<ul class="d-tree-select_list-item_sublist">':""}\n                            ${a}\n                        ${a.length?"</ul>":""}\n                    </li>\n                `)}),t.join("")},checkCloseCategoryMenu(e){if(e.target.closest(".d-atom-menu-category-select")){let t,s=e.target.closest(".d-atom");s?t=s.id.split("-").pop():(s=e.target.closest(".d-control-select-tree"),t=s.id.split("-").pop()),this.itemId!=t&&(this.isCategoryListOpened=!1)}else this.isCategoryListOpened=!1,this.removeEditClass()},getControlAtomId(){return"d-control-"+this.item.name+"-"+this.itemId},addEditClass(){this.addRowEditClass&&(this.addRowEditClass(),this.disableEditModeModules()),document.addEventListener(this.$clickevent,this.checkCloseCategoryMenu)},removeEditClass(){this.removeRowEditClass&&(this.removeRowEditClass(),this.enableEditModeModules()),document.removeEventListener(this.$clickevent,this.checkCloseCategoryMenu)}}}},391:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.getHiddenClasses()},[s("AtomMarginZone",{attrs:{"block-id":e.blockId,"item-id":e.itemId}}),e._v(" "),s("div",{ref:"thisAtom",staticClass:"d-atom d-atom-menu-container",attrs:{id:e.getAtomIdByBlockId()},on:{click:function(t){return t.preventDefault(),e.openAtomMenuParams(t)}}},[s("div",{staticClass:"d-atom-instance d-atom-menu no-hover"},[e.inLoading?e._e():[!1===e.getRootId?s("div",{staticClass:"d-atom-no-menu d-atom-none-select-instance"},[s("div",{staticClass:"d-atom-none-select"},[s("div",{staticClass:"d-atom-none-select-select-wrapper"},[s("p",[e._v(e._s(e.lang("Выберите тип:")))]),e._v(" "),s("select",{ref:"menuTypeSelect",staticClass:"d-atom-none-select-form-select",on:{change:function(t){return t.preventDefault(),e.onMenuTypeSelect(t)}}},[e._l(e.typeList,(function(t,i){return[s("option",{domProps:{value:i,selected:e.isThisMenuType(i)}},[e._v(e._s(t))])]}))],2)]),e._v(" "),e.isMenuTypeSelected()?s("div",{staticClass:"d-atom-none-select-select-wrapper"},[s("p",[e._v(e._s(e.lang("Выберите пункт:")))]),e._v(" "),"menu"==e.getMenuType?s("div",{staticClass:"d-atom-menu-category-select"},[s("select",{ref:"menuSelect",staticClass:"d-menu-select d-atom-none-select-form-select",domProps:{innerHTML:e._s(e.getMenuItemsTree())}})]):s("div",{staticClass:"d-atom-menu-category-select"},[s("div",{staticClass:"d-tree-select",class:{open:e.isCategoryListOpened}},[s("div",{staticClass:"d-tree-select_selected-box",on:{click:function(t){return t.preventDefault(),e.onToggleCategorySelect(t)}}},[s("div",{ref:"selectedCategory",staticClass:"d-tree-select_selected-values",domProps:{textContent:e._s(e.currentSelectedCategory)}}),e._v(" "),e._m(0)]),e._v(" "),e.isCategoryListOpened?s("div",{staticClass:"d-tree-select_drop-box"},[s("ul",{staticClass:"d-tree-select_list",domProps:{innerHTML:e._s(e.getCategoryItemsTree())},on:{click:function(t){return t.preventDefault(),e.onCategoryClickEvents(t)}}})]):e._e()])])]):e._e(),e._v(" "),"none"!=e.getMenuType&&e.isNeedShowSelectButton?s("a",{staticClass:"d-green-button",on:{click:function(t){return t.preventDefault(),e.onMenuSelected(t)}}},[e._v(e._s(e.lang("Выбрать")))]):e._e(),e._v(" "),s("a",{staticClass:"d-gray-button",attrs:{href:e.addMenuHref(),target:"_blank"},on:{click:function(e){e.stopPropagation()}}},[e._v(e._s(e.lang("Добавить меню")))]),e._v(" "),s("a",{staticClass:"d-gray-button",attrs:{href:e.addCategoryHref(),target:"_blank"},on:{click:function(e){e.stopPropagation()}}},[e._v(e._s(e.lang("Добавить категорию")))])])]):s("div",{staticClass:"d-atom-menu-wrapper",class:e.getAtomClass()},[s("WidthResize",{attrs:{"block-id":e.blockId,"item-id":e.itemId}}),e._v(" "),Object.keys(e.menuList).length?s("div",{staticClass:"d-atom-menu-wrapper-content"},[e.getAttrValue("show_mobile_button")>0?s("div",{staticClass:"d-atom-menu-mobile-button-wrapper"},[s("a",{staticClass:"d-atom-menu-mobile-button"},[s("span",{staticClass:"d-atom-menu-mobile-button-inside"},[s("span",{staticClass:"d-atom-menu-mobile-button-icon"}),e._v(" "),e.getAttrValue("mobile_button_text").length>0?s("span",{staticClass:"d-atom-menu-mobile-button-text"},[e._v(e._s(e.getAttrValue("mobile_button_text")))]):e._e()])])]):e._e(),e._v(" "),s("ul",{staticClass:"d-atom-menu-items",class:{"d-show-mobile-button":e.getAttrValue("show_mobile_button")>0}},e._l(e.menuList,(function(t,i){return s("li",{key:i,staticClass:"d-atom-menu-item"},[s("a",{staticClass:"d-atom-menu-link",attrs:{href:t.link}},[e._v(e._s(t.title)),e.isDownIconMenuShow(t)?s("span",{staticClass:"d-atom-menu-down"}):e._e()]),e._v(" "),e.isNeedShowSecondLevel(t)?s("ul",{staticClass:"d-atom-sub-menu-items d-hover-display",class:[e.getAttrValue("second_menu_type")]},e._l(t.childs,(function(t,i){return s("li",{key:i,staticClass:"d-atom-sub-menu-item"},[s("a",{staticClass:"d-atom-menu-sub-link",attrs:{href:t.link}},[e._v(e._s(t.title)),e.isDownIconSubMenuShow(t)?s("span",{staticClass:"d-atom-sub-menu-down"}):e._e()]),e._v(" "),e.isNeedShowThirdLevel(t)?s("ul",{staticClass:"d-atom-sub-sub-menu-items d-hover-display",class:[e.getAttrValue("third_menu_type")]},e._l(t.childs,(function(t,i){return s("li",{key:i,staticClass:"d-atom-sub-sub-menu-item"},[s("a",{staticClass:"d-atom-menu-sub-sub-link",attrs:{href:t.link}},[e._v(e._s(t.title))])])})),0):e._e()])})),0):e._e()])})),0),e._v(" "),e.getAttrValue("show_mobile_button")>0?[s("a",{staticClass:"designer-mmenu",staticStyle:{display:"none"},attrs:{"data-id":e.getMenuOpenDataId}}),e._v(" "),s("div",{staticClass:"d-mmenu-wrapper",attrs:{"data-mmenu-id":e.getMenuOpenDataId,"data-title":e.getAttrValue("mobile_menu_header")}},[s("ul",{staticClass:"d-mobile-mmenu-level d-open"},e._l(e.menuList,(function(t,i){return s("li",{key:i,staticClass:"d-mobile-mmenu-level-li"},[s("a",{staticClass:"d-mobile-mmenu-level-a",attrs:{href:t.link}},[e._v(e._s(t.title))]),e._v(" "),t.childs.length>0?s("span",{staticClass:"d-mobile-mmenu-open-level",attrs:{"data-title":t.title}}):e._e(),e._v(" "),t.childs.length>0?s("ul",{staticClass:"d-mobile-mmenu-level"},[s("li",{staticClass:"d-mobile-mmenu-level-li d-mobile-mmenu-close-level",attrs:{"data-title":e.getAttrValue("mobile_menu_header")}},[s("span",{staticClass:"d-mobile-mmenu-open-level d-mobile-mmenu-open-level-close"}),e._v(" "),s("a",{staticClass:"d-mobile-mmenu-level-a",attrs:{href:"#"}},[e._v(e._s(t.title))])]),e._v(" "),e._l(t.childs,(function(t,i){return s("li",{key:i,staticClass:"d-mobile-mmenu-level-li"},[s("a",{staticClass:"d-mobile-mmenu-level-a",attrs:{href:t.link}},[e._v(e._s(t.title))]),e._v(" "),t.childs.length>0?s("span",{staticClass:"d-mobile-mmenu-open-level",attrs:{"data-title":t.title}}):e._e(),e._v(" "),t.childs.length>0?s("ul",{staticClass:"d-mobile-mmenu-level"},[s("li",{staticClass:"d-mobile-mmenu-level-li d-mobile-mmenu-close-level",attrs:{"data-title":t.title}},[s("span",{staticClass:"d-mobile-mmenu-open-level d-mobile-mmenu-open-level-close",attrs:{"data-title":t.title}}),e._v(" "),s("a",{staticClass:"d-mobile-mmenu-level-a",attrs:{href:"#"}},[e._v(e._s(t.title))])]),e._v(" "),e._l(t.childs,(function(t,i){return s("li",{key:i,staticClass:"d-mobile-mmenu-level-li"},[s("a",{staticClass:"d-mobile-mmenu-level-a",attrs:{href:t.link}},[e._v(e._s(t.title))])])}))],2):e._e()])}))],2):e._e()])})),0)])]:e._e()],2):[s("div",{staticClass:"d-atom-form"},[s("div",{staticClass:"d-in-loading"},[e._v(e._s(e.lang("Нет подпунктов для отображения")))])])]],2)],e._v(" "),e.inLoading?[s("div",{staticClass:"d-atom-form"},[s("div",{staticClass:"d-in-loading"},[e._v(e._s(e.lang("Подождите...")))])])]:e._e()],2)])],1)};i._withStripped=!0;var a=s(366),l=s(373),o=s(30);class n extends o.a{getMenuList(e=!1,t=0){let s={root:t};e&&(s.showAll=1);let i=this.createUrlWithParams(window.global.designer.menu.getMenuListUrl,s);return this.makeGETRequest(i)}getCategoryList(e=!1,t=0){let s={root:t};e&&(s.showAll=1);let i=this.createUrlWithParams(window.global.designer.menu.getCategoryListUrl,s);return this.makeGETRequest(i)}}const d=new n;var r={data:()=>({typeList:{none:lang.t("Не выбрано"),menu:lang.t("Пунты меню"),category:lang.t("Пункт категории")},inLoading:!0,menuTree:{},load_js:[window.global.designer.mobilemenu_js_url]}),mounted(){this.onMount(),this.setRedrawAtomListener(this.onMount)},beforeDestroy(){this.removeEditClass(),this.removeRedrawAtomListener(this.onMount)},methods:{onMount(){this.inLoading=!0,!1===this.getRootId?this.uploadMenuToChoose():this.uploadSelectedMenu()},openAtomMenuParams(){this.body.removeEventListener("keyup",this.checkDeleteAtom),!1===this.getRootId?(this.setOpenHover(),this.body.addEventListener("keyup",this.checkDeleteAtom)):(this.addRowEditClass(),this.disableEditModeModules(),this.openAtomParams())},uploadMenuToChoose(){let e=this.getData();"category"==e.menu_type?d.getCategoryList().then(e=>{this.insertCategoriesToTree(this.categoryTree,e.list),this.inLoading=!1,this.categoriesLoaded.push(0),this.isNeedShowSelectButton=!0}):d.getMenuList().then(t=>{this.menuTree=t.list,this.inLoading=!1,"menu"==e.menu_type&&(this.isNeedShowSelectButton=!0)}),this.currentSelectedCategory=lang.t("Не выбрано")},addMenuHref:()=>window.global.designer.menu.menuAddUrl,addCategoryHref:()=>window.global.designer.menu.categoryAddUrl,uploadSelectedMenu(){"category"==this.getData().menu_type?d.getCategoryList(!0,this.getRootId).then(e=>{this.insertCategoriesToTree(this.categoryTree,e.list),this.inLoading=!1}):d.getMenuList(!0,this.getRootId).then(e=>{this.menuTree=e.list,this.inLoading=!1})},onMenuTypeSelect(e){let t=this.getData();switch(t.menu_type=e.target.value,this.isNeedShowSelectButton=!1,t.menu_type){case"menu":this.inLoading=!0,d.getMenuList().then(e=>{this.menuTree=e.list,this.inLoading=!1}),this.removeEditClass(),this.isNeedShowSelectButton=!0;break;case"category":this.inLoading=!0,this.currentSelectedCategory=lang.t("Не выбрано"),d.getCategoryList().then(e=>{this.insertCategoriesToTree(this.categoryTree,e.list),this.inLoading=!1,this.categoriesLoaded.push(0)});break;case"none":default:this.removeEditClass()}this.setAtomData(t)},isThisMenuType(e){return e==this.getData().menu_type},isMenuTypeSelected(){return"none"!=this.getMenuType},isDownIconMenuShow(e){return e.childs&&e.childs.length>0&&this.getAttrValue("menu_show_level")>=2&&this.getAttrValue("show_down_menu_icon")},isDownIconSubMenuShow(e){return e.childs&&e.childs.length>0&&3==this.getAttrValue("menu_show_level")&&this.getAttrValue("show_down_sub_menu_icon")},getMenuOptionsForSelectLeafs(e){let t="";return Object.keys(e).forEach(s=>{let i=e[s];t+=`<option value="${i.id}">${i.title}</option>`,i.childs&&i.childs.length>0&&(t+=`<optgroup label="${i.title}">${this.getMenuOptionsForSelectLeafs(i.childs)}</optgroup>`)}),t},getMenuItemsTree(){return this.getMenuOptionsForSelectLeafs(this.menuTree)},onMenuSelected(e){this.loading=!0;let t=this.getData();"menu"==this.getMenuType?t.root=this.$refs.menuSelect.value:t.root=this.$refs.selectedCategory.dataset.id,this.setAtomData(t),this.uploadSelectedMenu(),e.preventDefault(),e.stopPropagation()},toggleCategory(e){let t=e.target,s=t.dataset.id,i=t.closest(".d-tree-branch");if(-1==this.categoriesLoaded.indexOf(s))i.classList.add("d-loading"),d.getCategoryList(!1,s).then(e=>{this.insertCategoriesToTree(this.categoryTree,e.list,s),this.categoriesLoaded.push(s)});else if(i.classList.toggle("d-tree-expanded"),i.classList.toggle("d-tree-collapsed"),this.isCategoryOpened(s)){let e=this.categoriesOpened.indexOf(s);this.categoriesOpened.splice(e,1)}else this.categoriesOpened.push(s);e.preventDefault(),e.stopPropagation()},getSubSubMenuClass(){return[this.getAttrValue("third_menu_type")]},isNeedShowSecondLevel(e){return e.firstWithChilds&&this.getAttrValue("show_second_menu")},isNeedShowThirdLevel(e){return e.firstWithChilds&&this.getAttrValue("show_third_menu")}},computed:{getMenuType(){return this.getData().menu_type},getRootId(){let e=this.getData();return"none"!=e.menu_type&&e.root},showMenuLevels(){return this.getAttrValue("menu_show_level")},menuList(){return"category"==this.getData().menu_type?this.categoryTree:this.menuTree},getMenuOpenDataId(){return this.blockId+"-"+this.itemId}}},c=s(100),u=s(367),m=s(99),h={name:"AtomMenu",mixins:[a.a,l.a,m.a,u.a,c.a,r],props:{itemId:{type:String,required:!0},colIndex:{type:Number,required:!0},blockId:{type:String,required:!0}},components:{AtomMarginZone:()=>s.e(21).then(s.bind(null,421)),WidthResize:()=>s.e(74).then(s.bind(null,422))}},g=s(98),p=Object(g.a)(h,i,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"d-tree-select_drop-chevron-box"},[t("i",{staticClass:"d-tree-select_drop-chevron zmdi zmdi-caret-down"})])}],!1,null,null,null);p.options.__file="-readyscript/modules/designer/view/js/app/src/components/designerblock/atoms/menu/menu.vue";t.default=p.exports}}]);